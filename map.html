<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- Google Fonts: Noto Sans JP, Open Sans, Noto Sans KR, Noto Sans TC, Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Open+Sans:wght@400;700&family=Noto+Sans+KR:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
  <meta charset="UTF-8" />
  <title>ãƒ•ãƒ©ã‚¤ãƒˆãƒãƒƒãƒ—</title>
  <link rel="stylesheet" href="css/common.css" />
  <link rel="stylesheet" href="css/home.css" />
  <script src="js/i18n.js"></script>
  <style>
body.map-fullscreen {
  background: #222;
  margin: 0;
  padding: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  color: #fff;
  font-family: 'Noto Sans JP', 'Open Sans', 'Noto Sans KR', 'Noto Sans TC', sans-serif;
}

body[lang="ja"], html[lang="ja"] .map-fullscreen {
  font-family: 'Noto Sans JP', 'Open Sans', 'Noto Sans KR', 'Noto Sans TC', sans-serif;
}
body[lang="en"], html[lang="en"] .map-fullscreen {
  font-family: 'Open Sans', 'Noto Sans JP', 'Noto Sans KR', 'Noto Sans TC', sans-serif;
}
body[lang="ko"], html[lang="ko"] .map-fullscreen {
  font-family: 'Noto Sans KR', 'Noto Sans JP', 'Open Sans', 'Noto Sans TC', sans-serif;
}
body[lang="zh"], html[lang="zh"] .map-fullscreen {
  font-family: 'Noto Sans TC', 'Noto Sans JP', 'Open Sans', 'Noto Sans KR', sans-serif;
}
    .map-header {
      width: 100vw;
      height: 60px;
      background: #232323;
      color: #fff;
      font-size: 2.1rem;
      display: flex;
      align-items: center;
      padding-left: 36px;
      font-weight: 400;
      letter-spacing: 0.04em;
      box-sizing: border-box;
      /* border-bottom: 4px solid #1976d2; å‰Šé™¤ */
    }
    .map-main {
      display: flex;
      flex-direction: row;
      width: 100vw;
      height: calc(100vh - 60px);
      background: #222;
      opacity: 0;
      transform: translateY(80px);
      transition: opacity 0.7s cubic-bezier(.4,0,.2,1), transform 0.7s cubic-bezier(.4,0,.2,1);
    }
    .map-main.slideup-animate {
      opacity: 1;
      transform: translateY(0);
    }
    .map-info-panel {
      width: 420px;
      min-width: 320px;
      max-width: 520px;
      background: #181818;
      color: #fff;
      padding: 28px 24px 28px 28px;
      box-sizing: border-box;
      font-size: 1.13rem;
      display: flex;
      flex-direction: column;
      gap: 14px;
      border-right: 2px solid #333;
      justify-content: flex-start;
      overflow-y: auto;
      max-height: 100%;
    }
    .map-info-panel h1 {
      font-size: 2.0rem;
      font-weight: 400;
      margin: 0 0 8px 0;
      letter-spacing: 0.04em;
    }
    .map-info-panel .map-label {
      font-size: 1.02rem;
      margin-bottom: 2px;
      opacity: 0.85;
    }
    .map-info-panel .map-value {
      font-size: 1.18rem;
      font-weight: 400;
      margin-bottom: 6px;
    }
    .map-info-panel .map-divider {
      border-top: 1.2px solid #fff3;
      margin: 8px 0 6px 0;
    }
    .map-image-panel {
      flex: 1 1 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #222;
      min-width: 0;
      min-height: 0;
      position: relative;
      gap: 20px;
    }
    .map-image {
      width: 92%;
      max-width: 900px;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 8px 32px #0008;
      border: 2px solid #333;
      background: #111;
      object-fit: contain;
    }
    .map-button {
      background: linear-gradient(135deg, #1976d2, #1565c0);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3);
      font-family: 'Noto Sans JP', 'Open Sans', 'Noto Sans KR', 'Noto Sans TC', sans-serif;
    }
    .map-button:hover {
      background: linear-gradient(135deg, #1565c0, #0d47a1);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(25, 118, 210, 0.4);
    }
    .map-button:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(25, 118, 210, 0.3);
    }
    @media (max-width: 900px) {
      .map-info-panel { width: 100vw; max-width: none; border-right: none; border-bottom: 2px solid #333; }
      .map-main { flex-direction: column; }
      .map-image-panel { min-height: 220px; }
    }
  </style>
</head>
<body class="map-fullscreen">
  <div class="map-header">
    <span id="header-seat"></span>ã€€<span id="header-route"></span>
    <div class="hm-header-icons" style="position:absolute; right:36px; top:0; height:60px; display:flex; align-items:center; gap:16px; z-index:10;">
      <button class="hm-dot hm-btn-home" title="" data-i18n="home;title" style="width:32px;height:32px;border-radius:50%;background:#bebebe;border:none;cursor:pointer;outline:none;margin-top:4px;display:flex;align-items:center;justify-content:center;font-size:1.7rem;"><span class="material-icons">home</span></button>
      <button class="hm-dot hm-btn-notice" title="" data-i18n="notice;title" style="width:32px;height:32px;border-radius:50%;background:#bebebe;border:none;cursor:pointer;outline:none;margin-top:4px;display:flex;align-items:center;justify-content:center;font-size:1.7rem;"><span class="material-icons">chat</span></button>
      <button class="hm-dot hm-btn-attendant" title="" data-i18n="call_attendant;title" style="width:32px;height:32px;border-radius:50%;background:#bebebe;border:none;cursor:pointer;outline:none;margin-top:4px;display:flex;align-items:center;justify-content:center;font-size:1.7rem;"><span class="material-icons">support_agent</span></button>
      <button class="hm-dot hm-btn-settings" title="" data-i18n="settings;title" style="width:32px;height:32px;border-radius:50%;background:#bebebe;border:none;cursor:pointer;outline:none;margin-top:4px;display:flex;align-items:center;justify-content:center;font-size:1.7rem;"><span class="material-icons">settings</span></button>
    </div>
  </div>
  <div class="map-main">
    <div class="map-info-panel">
      <h1 data-i18n="moving_map">MOVING MAP</h1>
      <div class="map-label" id="flight-number-label" data-i18n="flight_number">ä¾¿å</div>
      <div class="map-value" id="flight-number-value">OZ117</div>
      <div class="map-divider"></div>
      <div class="map-label" data-i18n="route">ãƒ«ãƒ¼ãƒˆ</div>
      <div class="map-value" id="route-value">é–¢è¥¿å›½éš›ç©ºæ¸¯ã‹ã‚‰ä»å·å›½éš›ç©ºæ¸¯</div>
      <div class="map-divider"></div>
      <div class="map-label" data-i18n="flight_time_to_arrival">ç›®çš„åœ°ã¾ã§ã®é£›è¡Œæ™‚é–“</div>
      <div class="map-value" id="flight-time-value">2æ™‚é–“00åˆ†</div>
      <div class="map-divider"></div>
      <div class="map-label" data-i18n="destination_temperature">ç›®çš„åœ°ã®æ°—æ¸©</div>
      <div class="map-value" id="temperature-value">å–å¾—ä¸­...</div>
      <div class="map-divider"></div>
      <div class="map-label" data-i18n="destination_local_time">ç›®çš„åœ°ã®ç¾åœ°æ™‚é–“</div>
      <div class="map-value" id="arrival-time-value">19:40</div>
      <div class="map-divider"></div>
      <div class="map-label" data-i18n="departure_local_time">å‡ºç™ºåœ°ã®ç¾åœ°æ™‚é–“</div>
      <div class="map-value" id="departure-time-value">19:40</div>
      <div class="map-divider"></div>
      <div class="map-label" data-i18n="flight_progress">é£›è¡Œé€²æ—</div>
      <div class="map-value" id="progress-value">50%</div>
    </div>
    <div class="map-image-panel">
      <div class="map-slideshow" style="width:92%;max-width:900px;aspect-ratio:16/9;position:relative;border-radius:12px;box-shadow:0 8px 32px #0008;border:2px solid #333;overflow:hidden;">
        <div class="slide slide-map" style="position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity 0.7s;opacity:1;z-index:1;background:linear-gradient(135deg,#2193b0 0%,#6dd5ed 100%);">
          <div style="position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center;">
            <img src="https://user-images.githubusercontent.com/1308249/326885857-2e2e2e2e-2e2e-2e2e-2e2e-2e2e2e2e2e2e.png" alt="moving map" style="width:100%;height:100%;object-fit:cover;filter:brightness(0.95);" />
            <div id="slideshow-plane-marker" style="position:absolute;top:50%;left:10%;transform:translate(-50%,-50%);z-index:2;width:36px;height:36px;pointer-events:none;">
              <svg width="36" height="36" viewBox="0 0 36 36"><polygon points="18,2 22,28 18,24 14,28" fill="#1976d2" stroke="#fff" stroke-width="2"/></svg>
            </div>
          </div>
          <div style="position:absolute;bottom:18px;left:0;right:0;text-align:center;color:#fff;background:rgba(0,0,0,0.45);padding:8px 0;font-size:1.15rem;">
            <span id="slideshow-progress-label" data-i18n="flight_progress_percent">é£›è¡Œé€²æ—: 50%</span>
          </div>
        </div>
        <div class="slide slide-weather" style="position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity 0.7s;opacity:0;z-index:0;background:linear-gradient(135deg,#f7971e 0%,#ffd200 100%);">
          <div style="font-size:2.1rem;font-weight:500;margin-bottom:12px;" data-i18n="local_weather">ç¾åœ°ã®å¤©æ°—</div>
          <div style="display:flex;align-items:center;gap:18px;">
            <span id="slideshow-weather-icon" style="font-size:3.2rem;">â˜€ï¸</span>
            <span id="slideshow-weather-temp" style="font-size:2.8rem;font-weight:700;">--â„ƒ</span>
          </div>
          <div id="slideshow-weather-desc" style="font-size:1.2rem;margin-top:8px;">å–å¾—ä¸­...</div>
        </div>
        <div class="slide slide-time" style="position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity 0.7s;opacity:0;z-index:0;background:linear-gradient(135deg,#43cea2 0%,#185a9d 100%);">
          <div style="font-size:2.1rem;font-weight:500;margin-bottom:12px;" data-i18n="local_time">ç¾åœ°ã®æ™‚åˆ»</div>
          <div id="slideshow-local-time" style="font-size:2.8rem;font-weight:700;">--:--</div>
          <div id="slideshow-local-date" style="font-size:1.2rem;margin-top:8px;">----</div>
        </div>
      </div>
      <button class="map-button" id="map-display-btn" data-i18n="map_btn">ãƒãƒƒãƒ—ã‚’è¡¨ç¤ºã™ã‚‹</button>
    </div>
  </div>
  <!-- PAã‚¢ãƒŠã‚¦ãƒ³ã‚¹ä¸­ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆANAé¢¨ï¼šä¸Šéƒ¨é»„è‰²å¸¯ï¼‹ä¸‹éƒ¨ç™½å››è§’ï¼‰ -->
  <div id="pa-announcement" class="pa-announcement">
    <div class="pa-announcement-yellow">
      <span id="pa-title">PA ä½œå‹•ä¸­</span>
    </div>
    <div class="pa-announcement-white">
      <div id="pa-message">ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ä¸­</div>
      <div id="pa-en">Passenger Announcement</div>
    </div>
  </div>
  <!-- ã‚¯ãƒªãƒƒã‚¯ç„¡åŠ¹ç”¨ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
  <div id="pa-blocker" style="display:none;position:fixed;inset:0;z-index:2100;"></div>
  <!-- è¨­å®šãƒ‘ãƒãƒ« -->
  <div id="settings-overlay" class="settings-overlay"></div>
  <aside id="settings-panel" class="settings-panel">
    <div class="settings-panel-inner">
      <h2 class="settings-title" data-i18n="settings">è¨­å®š</h2>
      <!-- éŸ³é‡ -->
      <div class="settings-row">
        <label class="settings-label" data-i18n="volume">éŸ³é‡</label>
        <div class="settings-slider-row">
          <button class="slider-btn" id="volume-down">-</button>
          <input type="range" id="volume-slider" min="0" max="100" value="60">
          <button class="slider-btn" id="volume-up">+</button>
        </div>
      </div>
      <!-- æ˜ã‚‹ã• -->
      <div class="settings-row">
        <label class="settings-label" data-i18n="brightness">ç”»é¢ã®æ˜ã‚‹ã•</label>
        <div class="settings-slider-row">
          <button class="slider-btn" id="brightness-down">-</button>
          <input type="range" id="brightness-slider" min="0" max="100" value="75">
          <button class="slider-btn" id="brightness-up">+</button>
        </div>
      </div>
      <!-- è¨€èª -->
      <div class="settings-row settings-row-flex">
        <label class="settings-label" data-i18n="language">è¨€èª</label>
        <span class="settings-value" id="language-value">æ—¥æœ¬èª</span>
      </div>
      <!-- ãŠçŸ¥ã‚‰ã› -->
      <div class="settings-row settings-row-flex">
        <label class="settings-label" data-i18n="notice">ãŠçŸ¥ã‚‰ã›</label>
        <label class="switch">
          <input type="checkbox" id="notice-toggle" checked>
          <span class="slider"></span>
        </label>
      </div>
      <div class="settings-row settings-row-note">
        <span class="settings-note" data-i18n="notice_note">ãŠçŸ¥ã‚‰ã›æ©Ÿèƒ½ã®ã‚ªãƒ³/ã‚ªãƒ•ï¼ˆé‡è¦ã‹ã¤å®‰å…¨ã«é–¢ã‚ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰ã€‚</span>
      </div>
      <!-- ä¿è­·è€…åˆ¶é™ -->
      <div class="settings-row settings-row-flex">
        <label class="settings-label" data-i18n="parental">ä¿è­·è€…åˆ¶é™</label>
        <span class="settings-value" data-i18n="parental_off">ã‚ªãƒ•</span>
      </div>
      <div class="settings-row settings-row-note">
        <span class="settings-note" data-i18n="parental_note">æ˜ ç”»ãƒ»ãƒ†ãƒ¬ãƒ“ç•ªçµ„ãƒ»ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ãƒ»ã‚ªãƒ¼ãƒ‡ã‚£ã‚ª...</span>
      </div>
      <button class="screen-off-btn" data-i18n="screen_off">ç”»é¢ã‚ªãƒ•</button>
    </div>
  </aside>

  <!-- é€šçŸ¥ãƒ‘ãƒãƒ« -->
  <div id="notice-overlay" class="settings-overlay"></div>
  <aside id="notice-panel" class="settings-panel">
    <div class="settings-panel-inner">
      <h2 class="settings-title" data-i18n="notice">ãŠçŸ¥ã‚‰ã›</h2>
      <div class="settings-row">
        <div id="notice-list">
          <div class="settings-note" data-i18n="notice_empty">ç¾åœ¨ãŠçŸ¥ã‚‰ã›ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>
        </div>
      </div>
    </div>
  </aside>
  <script>
    // ãƒ•ãƒ©ã‚¤ãƒˆæƒ…å ±ã¨æ°—æ¸©å–å¾—ã®åˆ¶å¾¡
    // i18nç¿»è¨³é©ç”¨é–¢æ•°
    function applyTranslations() {
      if (!window.i18n) return;
      
      const lang = localStorage.getItem('language') || 'ja';
      const i18n = window.i18n[lang] || window.i18n['ja'];
      
      // data-i18nå±æ€§ã‚’æŒã¤ã™ã¹ã¦ã®è¦ç´ ã‚’å‡¦ç†
      const elements = document.querySelectorAll('[data-i18n]');
      elements.forEach(element => {
        const keys = element.getAttribute('data-i18n').split(';');
        
        if (keys.length === 1) {
          // å˜ä¸€ã®ç¿»è¨³ã‚­ãƒ¼ï¼ˆè¦ç´ ã®ãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç½®æ›ï¼‰
          const key = keys[0].trim();
          if (i18n[key]) {
            element.textContent = i18n[key];
          }
        } else if (keys.length === 2) {
          // ç¿»è¨³ã‚­ãƒ¼ã¨å±æ€§å
          const key = keys[0].trim();
          const attr = keys[1].trim();
          if (i18n[key]) {
            element.setAttribute(attr, i18n[key]);
          }
        }
      });
      
      // è¨€èªè¨­å®šãƒ‘ãƒãƒ«ã®è¨€èªåè¡¨ç¤ºã‚’æ›´æ–°
      const languageValue = document.getElementById('language-value');
      if (languageValue) {
        const langNames = { ja: 'æ—¥æœ¬èª', en: 'English', ko: 'í•œêµ­ì–´', zh: 'ä¸­æ–‡' };
        if (i18n.lang_ja) langNames.ja = i18n.lang_ja;
        if (i18n.lang_en) langNames.en = i18n.lang_en;
        if (i18n.lang_ko) langNames.ko = i18n.lang_ko;
        if (i18n.lang_zh) langNames.zh = i18n.lang_zh;
        
        languageValue.textContent = langNames[lang] || langNames['ja'];
      }
    }
    
    document.addEventListener('DOMContentLoaded', function() {
      // è¨€èªã«å¿œã˜ã¦body/langå±æ€§ã‚’åˆ‡ã‚Šæ›¿ãˆï¼ˆlocalStorage.languageå„ªå…ˆï¼‰
      var lang = localStorage.getItem('language') || 'ja';
      document.body.setAttribute('lang', lang);
      document.documentElement.setAttribute('lang', lang);
      
      // ç¿»è¨³ã‚’é©ç”¨
      applyTranslations();

      // --- æ˜ã‚‹ã•åŒæœŸ ---
      var brightness = localStorage.getItem('brightnessPercent');
      if (brightness) {
        document.body.style.filter = `brightness(${brightness}%)`;
      }
      var brightnessSlider = document.getElementById('brightness-slider');
      if (brightnessSlider) {
        brightnessSlider.value = brightness || brightnessSlider.value;
        brightnessSlider.oninput = function() {
          document.body.style.filter = `brightness(${this.value}%)`;
          localStorage.setItem('brightnessPercent', this.value);
        };
      }

      // ãƒ•ãƒ©ã‚¤ãƒˆæƒ…å ±ã‚’localStorageã‹ã‚‰å–å¾—ã—ã¦è¡¨ç¤º
      function updateFlightInfo() {
        const seatNumber = localStorage.getItem('seatNumber') || '31A';
        const flightNumber = localStorage.getItem('flightNumber') || 'OZ117';
        const departureID = localStorage.getItem('departureID') || 'KIX';
        const arrivalID = localStorage.getItem('arrivalID') || 'ICN';
        const departureCity = localStorage.getItem('departureCity') || 'å¤§é˜ªï¼ˆé–¢è¥¿ï¼‰';
        const arrivalCity = localStorage.getItem('arrivalCity') || 'ã‚½ã‚¦ãƒ«ï¼ˆä»å·ï¼‰';
        const depTime = localStorage.getItem('depTime') || '19:10';
        const arrTime = localStorage.getItem('arrTime') || '21:00';
        const progressPercent = localStorage.getItem('progressPercent') || '50';

        // ãƒ˜ãƒƒãƒ€ãƒ¼æ›´æ–°
        document.getElementById('header-seat').textContent = seatNumber;
        document.getElementById('header-route').textContent = `${departureID} â€“ ${arrivalID}`;

        // ãƒ•ãƒ©ã‚¤ãƒˆæƒ…å ±æ›´æ–°
        document.getElementById('flight-number-value').textContent = flightNumber;
        document.getElementById('route-value').textContent = `${departureCity}ã‹ã‚‰${arrivalCity}`;
        document.getElementById('departure-time-value').textContent = depTime;
        document.getElementById('arrival-time-value').textContent = arrTime;
        document.getElementById('progress-value').textContent = `${progressPercent}%`;

        // é£›è¡Œæ™‚é–“è¨ˆç®—ï¼ˆç°¡æ˜“ç‰ˆï¼‰
        const depTimeParts = depTime.split(':');
        const arrTimeParts = arrTime.split(':');
        const depMinutes = parseInt(depTimeParts[0]) * 60 + parseInt(depTimeParts[1]);
        const arrMinutes = parseInt(arrTimeParts[0]) * 60 + parseInt(arrTimeParts[1]);
        let flightMinutes = arrMinutes - depMinutes;
        if (flightMinutes < 0) flightMinutes += 24 * 60; // æ—¥ã‚’ã¾ãŸãå ´åˆ
        const hours = Math.floor(flightMinutes / 60);
        const minutes = flightMinutes % 60;
        document.getElementById('flight-time-value').textContent = `${hours}æ™‚é–“${minutes.toString().padStart(2, '0')}åˆ†`;
      }

      // æ°—æ¸©å–å¾—é–¢æ•°
      async function getWeatherData() {
        const arrivalID = localStorage.getItem('arrivalID') || 'ICN';
        const apiKey = 'YOUR_API_KEY'; // OpenWeatherMap APIã‚­ãƒ¼ã‚’è¨­å®š
        
        // ç©ºæ¸¯IDã‹ã‚‰éƒ½å¸‚åã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°
        const cityMapping = {
          'ICN': 'Incheon',
          'KIX': 'Osaka',
          'NRT': 'Tokyo',
          'HND': 'Tokyo',
          'NGO': 'Nagoya',
          'FUK': 'Fukuoka',
          'CTS': 'Sapporo',
          'TPE': 'Taipei',
          'PUS': 'Busan'
        };

        const cityName = cityMapping[arrivalID] || 'Incheon';
        
        try {
          // å®Ÿéš›ã®APIã‚­ãƒ¼ãŒãªã„å ´åˆã¯ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
          if (apiKey === 'YOUR_API_KEY') {
            // ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿéš›ã®APIã‚­ãƒ¼ãŒã‚ã‚‹å ´åˆã¯å‰Šé™¤ï¼‰
            const mockTemps = {
              'ICN': { temp: 18, tempF: 64 },
              'KIX': { temp: 22, tempF: 72 },
              'NRT': { temp: 20, tempF: 68 },
              'HND': { temp: 21, tempF: 70 },
              'NGO': { temp: 23, tempF: 73 },
              'FUK': { temp: 25, tempF: 77 },
              'CTS': { temp: 15, tempF: 59 },
              'TPE': { temp: 26, tempF: 79 },
              'PUS': { temp: 19, tempF: 66 }
            };
            
            const tempData = mockTemps[arrivalID] || mockTemps['ICN'];
            document.getElementById('temperature-value').textContent = `${tempData.temp}â„ƒ\n${tempData.tempF}â„‰`;
            return;
          }

          // å®Ÿéš›ã®APIå‘¼ã³å‡ºã—ï¼ˆAPIã‚­ãƒ¼ãŒã‚ã‚‹å ´åˆï¼‰
          const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${cityName}&appid=${apiKey}&units=metric`);
          const data = await response.json();
          
          if (data.main && data.main.temp) {
            const tempC = Math.round(data.main.temp);
            const tempF = Math.round((tempC * 9/5) + 32);
            document.getElementById('temperature-value').textContent = `${tempC}â„ƒ\n${tempF}â„‰`;
          } else {
            document.getElementById('temperature-value').textContent = 'å–å¾—ã‚¨ãƒ©ãƒ¼';
          }
        } catch (error) {
          console.error('æ°—æ¸©å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
          document.getElementById('temperature-value').textContent = 'å–å¾—ã‚¨ãƒ©ãƒ¼';
        }
      }

      // åˆæœŸåŒ–
      updateFlightInfo();
      getWeatherData();

      // 5åˆ†ã”ã¨ã«æ°—æ¸©ã‚’æ›´æ–°
      setInterval(getWeatherData, 5 * 60 * 1000);

      const homeBtn = document.querySelector('.hm-btn-home');
      if (homeBtn) {
        homeBtn.onclick = function(e) {
          e.stopPropagation();
          window.location.href = 'home.html';
        };
      }
      // å®¢å®¤ä¹—å‹™å“¡å‘¼ã³å‡ºã—ãƒœã‚¿ãƒ³åˆ¶å¾¡
      const attendantBtn = document.querySelector('.hm-btn-attendant');
      if (attendantBtn) {
        attendantBtn.onclick = function(e) {
          e.stopPropagation();
          alert('å®¢å®¤ä¹—å‹™å“¡ã‚’ãŠå‘¼ã³å‡ºã—ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚');
        };
      }
      
      // ãƒãƒƒãƒ—è¡¨ç¤ºãƒœã‚¿ãƒ³åˆ¶å¾¡ï¼ˆç¬é–“ãƒ–ãƒ©ãƒƒã‚¯ã‚¢ã‚¦ãƒˆï¼‹2ç§’è¡¨ç¤ºï¼‹ã‚«ãƒƒãƒˆé·ç§»åŠ¹æœä»˜ãï¼‰
      const mapDisplayBtn = document.getElementById('map-display-btn');
      if (mapDisplayBtn) {
        mapDisplayBtn.onclick = function(e) {
          e.stopPropagation();
          
          // ç¬é–“çš„ã«ãƒ–ãƒ©ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”¨ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’ä½œæˆï¼ˆå³åº§ã«ä¸é€æ˜ï¼‰
          const blackoutOverlay = document.createElement('div');
          blackoutOverlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            opacity: 1;
            z-index: 9999;
          `;
          document.body.appendChild(blackoutOverlay);
          
          // 2ç§’é–“ãƒ–ãƒ©ãƒƒã‚¯ã‚¢ã‚¦ãƒˆçŠ¶æ…‹ã‚’ç¶­æŒ
          setTimeout(() => {
            // é»’ã„ç”»é¢ã‹ã‚‰ç›´æ¥æ–°ã—ã„ãƒšãƒ¼ã‚¸ã«ã‚«ãƒƒãƒˆé·ç§»
            window.location.href = '/flight-maps/index.html';
          }, 2000); // 2ç§’é–“è¡¨ç¤º
        };
      }
    });
    // --- PAã‚¢ãƒŠã‚¦ãƒ³ã‚¹ä¸­ãƒ€ã‚¤ã‚¢ãƒ­ã‚°åˆ¶å¾¡ ---
    // home.htmlã¨åŒã˜åˆ¶å¾¡ã‚’map.htmlã«ã‚‚å®Ÿè£…
    let paDialog = null, paTitle = null, paMessage = null, paEn = null, paKeyDown = false, paBlocker = null;
    function setPADialogLang() {
      const lang = localStorage.getItem('language') || 'ja';
      if (!window.i18n) return;
      const i18n = window.i18n[lang] || window.i18n['ja'];
      if (paTitle) paTitle.textContent = i18n.pa_title || 'PA ä½œå‹•ä¸­';
      if (paMessage) paMessage.textContent = i18n.pa_message || 'ãŸã ã„ã¾ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ä¸­ã§ã™ã€‚';
      if (paEn) paEn.innerHTML = (i18n.pa_en || 'Passenger Announcement');
    }
    function updatePADialog() {
      if (!paDialog || !paBlocker) return;
      if (paKeyDown) {
        setPADialogLang();
        paDialog.style.display = 'flex';
        paBlocker.style.display = 'block';
      } else {
        paDialog.style.display = 'none';
        paBlocker.style.display = 'none';
      }
    }
    document.addEventListener('keydown', function(e) {
      if ((e.key === 'a' || e.key === 'A')) {
        if (!paKeyDown) {
          paKeyDown = true;
          updatePADialog();
        }
      }
      if (e.key === 's' || e.key === 'S') {
        // Sã‚­ãƒ¼ã§ã‚»ãƒ¼ãƒ•ãƒ†ã‚£ãƒ“ãƒ‡ã‚ªãƒšãƒ¼ã‚¸ã¸é·ç§»
        window.location.href = 'sb-movie.html';
      }
    });
    document.addEventListener('keyup', function(e) {
      if (e.key === 'a' || e.key === 'A') {
        if (paKeyDown) {
          paKeyDown = false;
          updatePADialog();
        }
      }
    });
    window.addEventListener('DOMContentLoaded', function() {
      paDialog = document.getElementById('pa-announcement');
      paTitle = document.getElementById('pa-title');
      paMessage = document.getElementById('pa-message');
      paEn = document.getElementById('pa-en');
      paBlocker = document.getElementById('pa-blocker');
      paKeyDown = false;
      updatePADialog();
      if (window.i18n) setPADialogLang();
      const main = document.querySelector('.map-main');
      if (main) {
        setTimeout(() => main.classList.add('slideup-animate'), 30);
      }
      // é€šçŸ¥ãƒ‘ãƒãƒ«åˆ¶å¾¡ï¼ˆhome.htmlã¨åŒã˜ã‚¯ãƒ©ã‚¹åã§å–å¾—ï¼‰
      // é€šçŸ¥ãƒ‘ãƒãƒ«åˆ¶å¾¡
      function setupPanel(btnSelector, panelSelector, overlaySelector) {
        const btn = document.querySelector(btnSelector);
        const panel = document.querySelector(panelSelector);
        const overlay = document.querySelector(overlaySelector);
        if (btn && panel && overlay) {
          btn.addEventListener('click', () => {
            panel.classList.add('open');
            overlay.classList.add('open');
          });
          overlay.addEventListener('click', () => {
            panel.classList.remove('open');
            overlay.classList.remove('open');
          });
        }
      }
      setupPanel('.hm-btn-notice', '#notice-panel', '#notice-overlay');
      setupPanel('.hm-btn-settings', '#settings-panel', '#settings-overlay');
      
      // è¨€èªåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
      const languageValue = document.getElementById('language-value');
      if (languageValue) {
        languageValue.style.cursor = 'pointer';
        languageValue.onclick = function() {
          const currentLang = localStorage.getItem('language') || 'ja';
          const langs = ['ja', 'en', 'ko', 'zh'];
          let idx = langs.indexOf(currentLang);
          idx = (idx + 1) % langs.length;
          localStorage.setItem('language', langs[idx]);
          
          // è¨€èªåã‚’æ›´æ–°
          const langNames = { ja: 'æ—¥æœ¬èª', en: 'English', ko: 'í•œêµ­ì–´', zh: 'ä¸­æ–‡' };
          languageValue.textContent = langNames[langs[idx]];
          
          // ç¿»è¨³ã‚’é©ç”¨
          applyTranslations();
          
          // è¨€èªå±æ€§ã‚’æ›´æ–°
          document.body.setAttribute('lang', langs[idx]);
          document.documentElement.setAttribute('lang', langs[idx]);
        };
        
        // åˆæœŸè¡¨ç¤ºæ™‚ã«è¨€èªåã‚’è¨­å®š
        const currentLang = localStorage.getItem('language') || 'ja';
        const langNames = { ja: 'æ—¥æœ¬èª', en: 'English', ko: 'í•œêµ­ì–´', zh: 'ä¸­æ–‡' };
        languageValue.textContent = langNames[currentLang];
      }
      
      // Escapeã‚­ãƒ¼ã§ä¸¡ãƒ‘ãƒãƒ«é–‰ã˜ã‚‹
      document.addEventListener('keydown', e => {
        if (e.key === 'Escape') {
          document.getElementById('notice-panel')?.classList.remove('open');
          document.getElementById('notice-overlay')?.classList.remove('open');
          document.getElementById('settings-panel')?.classList.remove('open');
          document.getElementById('settings-overlay')?.classList.remove('open');
        }
      });
      // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®+-ãƒœã‚¿ãƒ³
      function stepSlider(sliderId, diff) {
        const slider = document.getElementById(sliderId);
        slider.value = Math.max(Number(slider.min), Math.min(Number(slider.max), Number(slider.value) + diff));
        slider.dispatchEvent(new Event('input'));
      }
      document.getElementById('volume-down').onclick = () => stepSlider('volume-slider', -5);
      document.getElementById('volume-up').onclick = () => stepSlider('volume-slider', 5);
      document.getElementById('brightness-down').onclick = () => stepSlider('brightness-slider', -5);
      document.getElementById('brightness-up').onclick = () => stepSlider('brightness-slider', 5);
      // ç”»é¢ã‚ªãƒ•ãƒœã‚¿ãƒ³
      const screenOffBtn = document.querySelector('.screen-off-btn');
      let screenOffOverlay = document.getElementById('screen-off-overlay');
      if (!screenOffOverlay) {
        screenOffOverlay = document.createElement('div');
        screenOffOverlay.id = 'screen-off-overlay';
        screenOffOverlay.style = 'display:none;position:fixed;inset:0;z-index:2147483647;background:#000;opacity:0.98;transition:opacity 0.3s;width:100vw;height:100vh;';
        document.body.appendChild(screenOffOverlay);
      }
      if (screenOffBtn && screenOffOverlay) {
        screenOffBtn.onclick = () => {
          screenOffOverlay.style.display = 'block';
          setTimeout(() => { screenOffOverlay.style.opacity = '0.98'; }, 10);
        };
        screenOffOverlay.onclick = () => {
          screenOffOverlay.style.opacity = '0';
          setTimeout(() => { screenOffOverlay.style.display = 'none'; }, 300);
        };
      }

      // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãƒœã‚¿ãƒ³åˆ¶å¾¡
      const controllerBtn = document.querySelector('.hm-btn-controller');
      if (controllerBtn) {
        controllerBtn.onclick = () => {
          openController();
        };
      }

      // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’é–‹ã
      function openController() {
        const controllerWindow = window.open('/remote-control/index.html', 'controller', 
          'width=800,height=600,resizable=yes,scrollbars=yes,status=yes');
        
        if (controllerWindow) {
          // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¨ã®é€šä¿¡è¨­å®š
          window.addEventListener('message', function(event) {
            handleControllerMessage(event.data);
          });
        }
      }

      // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†
      function handleControllerMessage(data) {
        switch(data.type) {
          case 'media_control':
            handleMediaControl(data.action);
            break;
          case 'volume_set':
            setVolume(data.volume);
            break;
          case 'brightness_set':
            setBrightness(data.brightness);
            break;
          case 'language_set':
            setLanguage(data.language);
            break;
          case 'announce_start':
            startAnnouncement(data.text);
            break;
          case 'announce_stop':
            stopAnnouncement();
            break;
          case 'emergency_stop':
            emergencyStop();
            break;
          case 'system_restart':
            restartSystem();
            break;
                  case 'controller_closed':
          console.log('ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒé–‰ã˜ã‚‰ã‚Œã¾ã—ãŸ');
          break;
        case 'send_notification':
          addNotification(data.title, data.message);
          break;
        case 'clear_notifications':
          clearAllNotifications();
          break;
        }
      }

      // ãƒ¡ãƒ‡ã‚£ã‚¢åˆ¶å¾¡å‡¦ç†ï¼ˆãƒãƒƒãƒ—ãƒšãƒ¼ã‚¸ç”¨ï¼‰
      function handleMediaControl(action) {
        console.log('ãƒãƒƒãƒ—ãƒšãƒ¼ã‚¸ãƒ¡ãƒ‡ã‚£ã‚¢åˆ¶å¾¡:', action);
        // ãƒãƒƒãƒ—ãƒšãƒ¼ã‚¸ã§ã¯ç‰¹åˆ¥ãªãƒ¡ãƒ‡ã‚£ã‚¢åˆ¶å¾¡ã¯ä¸è¦
      }

      // éŸ³é‡è¨­å®š
      function setVolume(volume) {
        const volumeSlider = document.getElementById('volume-slider');
        if (volumeSlider) {
          volumeSlider.value = volume;
          volumeSlider.dispatchEvent(new Event('input'));
        }
        localStorage.setItem('volumePercent', volume);
      }

      // æ˜ã‚‹ã•è¨­å®š
      function setBrightness(brightness) {
        document.body.style.filter = `brightness(${brightness}%)`;
        localStorage.setItem('brightnessPercent', brightness);
      }

      // è¨€èªè¨­å®š
      function setLanguage(language) {
        localStorage.setItem('language', language);
        location.reload();
      }

      // PAã‚¢ãƒŠã‚¦ãƒ³ã‚¹åˆ¶å¾¡
      function startAnnouncement(text) {
        console.log('ã‚¢ãƒŠã‚¦ãƒ³ã‚¹é–‹å§‹:', text);
        if (paDialog && paMessage) {
          paMessage.textContent = text;
          paKeyDown = true;
          updatePADialog();
        }
      }

      function stopAnnouncement() {
        console.log('ã‚¢ãƒŠã‚¦ãƒ³ã‚¹åœæ­¢');
        if (paDialog) {
          paKeyDown = false;
          updatePADialog();
        }
      }

      // ç·Šæ€¥åˆ¶å¾¡
      function emergencyStop() {
        console.log('ç·Šæ€¥åœæ­¢å®Ÿè¡Œ');
        // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚’åœæ­¢
      }

      function restartSystem() {
        console.log('ã‚·ã‚¹ãƒ†ãƒ å†èµ·å‹•');
        // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã‚’å†èµ·å‹•
        if (confirm('ã‚·ã‚¹ãƒ†ãƒ ã‚’å†èµ·å‹•ã—ã¾ã™ã‹ï¼Ÿ')) {
          location.reload();
        }
      }

      // é€šçŸ¥ç®¡ç†æ©Ÿèƒ½
      function addNotification(title, message) {
        const noticeList = document.getElementById('notice-list');
        if (noticeList) {
          // æ—¢å­˜ã®ç©ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
          const emptyNote = noticeList.querySelector('.settings-note');
          if (emptyNote && emptyNote.textContent.includes('ç¾åœ¨ãŠçŸ¥ã‚‰ã›ã¯ã‚ã‚Šã¾ã›ã‚“')) {
            emptyNote.remove();
          }
          
          // æ–°ã—ã„é€šçŸ¥ã‚’ä½œæˆ
          const notification = document.createElement('div');
          notification.className = 'notification-item';
          notification.style.cssText = `
            background: #f5f5f5;
            border-left: 4px solid #1976d2;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 4px;
          `;
          
          const titleEl = document.createElement('div');
          titleEl.style.cssText = 'font-weight: bold; color: #1976d2; margin-bottom: 4px;';
          titleEl.textContent = title;
          
          const messageEl = document.createElement('div');
          messageEl.style.cssText = 'color: #333; font-size: 0.9rem;';
          messageEl.textContent = message;
          
          const timeEl = document.createElement('div');
          timeEl.style.cssText = 'color: #666; font-size: 0.8rem; margin-top: 4px;';
          timeEl.textContent = new Date().toLocaleString('ja-JP');
          
          notification.appendChild(titleEl);
          notification.appendChild(messageEl);
          notification.appendChild(timeEl);
          
          noticeList.appendChild(notification);
          
          console.log('é€šçŸ¥ã‚’è¿½åŠ ã—ã¾ã—ãŸ:', title, message);
        }
      }

      function clearAllNotifications() {
        const noticeList = document.getElementById('notice-list');
        if (noticeList) {
          noticeList.innerHTML = '<div class="settings-note">ç¾åœ¨ãŠçŸ¥ã‚‰ã›ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
          console.log('å…¨é€šçŸ¥ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        }
      }
    });
  </script>
  <!-- --- ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼åˆ¶å¾¡ --- -->
  <script>
    (function(){
      let current = 0;
      const slides = [];
      document.addEventListener('DOMContentLoaded', function() {
        slides.push(
          document.querySelector('.slide-map'),
          document.querySelector('.slide-weather'),
          document.querySelector('.slide-time')
        );
        function showSlide(idx) {
          slides.forEach((el,i)=>{
            el.style.opacity = (i===idx)?'1':'0';
            el.style.zIndex = (i===idx)?'1':'0';
          });
        }
        setInterval(()=>{
          current = (current+1)%slides.length;
          showSlide(current);
        },4000);
        showSlide(0);
        // --- ãƒãƒƒãƒ—é€²æ—ãƒ»ãƒãƒ¼ã‚«ãƒ¼ ---
        function updateMapSlide() {
          const percent = parseFloat(localStorage.getItem('progressPercent')||'50');
          document.getElementById('slideshow-progress-label').textContent = `é£›è¡Œé€²æ—: ${percent}%`;
          // ãƒãƒ¼ã‚«ãƒ¼ä½ç½®
          const marker = document.getElementById('slideshow-plane-marker');
          const left = 10 + 80 * (percent/100);
          const top = 50 - 30 * (percent/100);
          marker.style.left = `${left}%`;
          marker.style.top = `${top}%`;
        }
        // --- å¤©æ°— ---
        function updateWeatherSlide() {
          // ãƒ¢ãƒƒã‚¯: å¤©æ°—ãƒ‡ãƒ¼ã‚¿
          let temp = '--â„ƒ', desc = 'å–å¾—ä¸­...', icon = 'â˜€ï¸';
          const tempRaw = document.getElementById('temperature-value').textContent||'--â„ƒ';
          temp = tempRaw.split('\n')[0];
          // ç°¡æ˜“: å¤©æ°—èª¬æ˜ã¨ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆæœ¬æ¥ã¯APIã®weather.descç­‰ã‚’ä½¿ã†ï¼‰
          // ä¾‹: "18â„ƒ\n64â„‰ æ™´ã‚Œ" ã®ã‚ˆã†ãªå ´åˆ
          const weatherText = tempRaw.split(' ').slice(1).join(' ');
          if(weatherText.includes('æ™´')) { desc = 'æ™´ã‚Œ'; icon = 'â˜€ï¸'; }
          else if(weatherText.includes('æ›‡')) { desc = 'ãã‚‚ã‚Š'; icon = 'â˜ï¸'; }
          else if(weatherText.includes('é›¨')) { desc = 'é›¨'; icon = 'ğŸŒ§ï¸'; }
          else { desc = 'ç›®çš„åœ°ã®å¤©æ°—'; icon = 'â˜€ï¸'; }
          document.getElementById('slideshow-weather-temp').textContent = temp;
          document.getElementById('slideshow-weather-desc').textContent = desc;
          document.getElementById('slideshow-weather-icon').textContent = icon;
        }
        // --- æ™‚åˆ» ---
        function updateTimeSlide() {
          // ç›®çš„åœ°ã®ç¾åœ°æ™‚é–“ã‚’è¡¨ç¤º
          const arrTime = document.getElementById('arrival-time-value').textContent||'--:--';
          document.getElementById('slideshow-local-time').textContent = arrTime;
          const now = new Date();
          document.getElementById('slideshow-local-date').textContent = `${now.getFullYear()}/${now.getMonth()+1}/${now.getDate()}`;
        }
        function updateAllSlides() {
          updateMapSlide();
          updateWeatherSlide();
          updateTimeSlide();
        }
        setInterval(updateAllSlides, 2000);
        updateAllSlides();
      });
    })();
  </script>
  <!-- --- ãƒ‘ãƒãƒ«é–‹é–‰ã®çµ±ä¸€JS --- -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // è¨­å®šãƒ‘ãƒãƒ«
      const settingsBtn = document.querySelector('.hm-btn-settings');
      const settingsPanel = document.getElementById('settings-panel');
      const settingsOverlay = document.getElementById('settings-overlay');
      if (settingsBtn && settingsPanel && settingsOverlay) {
        settingsBtn.onclick = () => {
          settingsPanel.classList.add('open');
          settingsOverlay.classList.add('open');
        };
        settingsOverlay.onclick = () => {
          settingsPanel.classList.remove('open');
          settingsOverlay.classList.remove('open');
        };
        document.addEventListener('keydown', e => {
          if (e.key === 'Escape') {
            settingsPanel.classList.remove('open');
            settingsOverlay.classList.remove('open');
          }
        });
      }
      // ãŠçŸ¥ã‚‰ã›ãƒ‘ãƒãƒ«
      const noticeBtn = document.querySelector('.hm-btn-notice');
      const noticePanel = document.getElementById('notice-panel');
      const noticeOverlay = document.getElementById('notice-overlay');
      if (noticeBtn && noticePanel && noticeOverlay) {
        noticeBtn.onclick = () => {
          noticePanel.classList.add('open');
          noticeOverlay.classList.add('open');
        };
        noticeOverlay.onclick = () => {
          noticePanel.classList.remove('open');
          noticeOverlay.classList.remove('open');
        };
        document.addEventListener('keydown', e => {
          if (e.key === 'Escape') {
            noticePanel.classList.remove('open');
            noticeOverlay.classList.remove('open');
          }
        });
      }
    });
  </script>
<script type="module">import { setupSync } from '/js/sync-client.js';setupSync();</script>
</body>
</html>
