<!DOCTYPE html>
<html lang="ja">
<head>
  <style>
    /* home.html/map.htmlと同じ下から上へのスライドインアニメーション */
    .hm-main {
      opacity: 0;
      transform: translateY(80px);
      transition: opacity 0.7s cubic-bezier(.4,0,.2,1), transform 0.7s cubic-bezier(.4,0,.2,1);
    }
    .hm-main.slideup-animate {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
  <!-- Google Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Open+Sans:wght@400;700&family=Noto+Sans+KR:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
  <meta charset="UTF-8" />
  <title>エンターテイメント</title>
  <link rel="stylesheet" href="css/home.css" />
  <link rel="stylesheet" href="css/entertainment.css" />
  <script src="js/i18n.js"></script>
  <script src="js/content-data.js"></script>
  <style>
body[lang="ja"], html[lang="ja"] .home-modern {
  font-family: 'Noto Sans JP', 'Open Sans', 'Noto Sans KR', 'Noto Sans TC', sans-serif;
}
body[lang="en"], html[lang="en"] .home-modern {
  font-family: 'Open Sans', 'Noto Sans JP', 'Noto Sans KR', 'Noto Sans TC', sans-serif;
}
body[lang="ko"], html[lang="ko"] .home-modern {
  font-family: 'Noto Sans KR', 'Noto Sans JP', 'Open Sans', 'Noto Sans TC', sans-serif;
}
body[lang="zh"], html[lang="zh"] .home-modern {
  font-family: 'Noto Sans TC', 'Noto Sans JP', 'Open Sans', 'Noto Sans KR', sans-serif;
}



    /* 通知・設定パネルのスタイル（home.htmlと同等） */
    .hm-panel {
      position: fixed;
      top: 0; right: 0;
      width: 340px;
      height: 100vh;
      background: #232323;
      color: #fff;
      z-index: 1002;
      box-shadow: -2px 0 16px #0008;
      transform: translateX(100%);
      transition: transform 0.35s cubic-bezier(.4,0,.2,1);
      display: flex;
      flex-direction: column;
    }
    .hm-panel.open { transform: translateX(0); }
    .hm-panel-header {
      font-size: 1.3rem;
      font-weight: 500;
      padding: 22px 24px 12px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .hm-panel-close {
      background: none; border: none; color: #fff; font-size: 2rem; cursor: pointer;
    }
    .hm-panel-content { flex: 1; padding: 0 24px 24px 24px; overflow-y: auto; }
    .hm-panel-divider { border-bottom: 1px solid #444; margin: 12px 0; }
    .hm-panel label { display: flex; align-items: center; gap: 10px; margin: 18px 0 0 0; }
    .hm-panel input[type=range] { width: 120px; }
    .hm-panel select { background: #232323; color: #fff; border: 1px solid #555; border-radius: 4px; padding: 4px 8px; }
    .hm-panel .hm-notice-list { margin: 0; padding: 0; list-style: none; }
    .hm-panel .hm-notice-list li { margin-bottom: 12px; font-size: 1.05rem; }
    .hm-panel .hm-notice-empty { color: #aaa; font-size: 1.1rem; margin-top: 18px; }
  </style>
  <style>
    /* このページ固有のボタンにフォントを適用 */
    #ent-watch-btn, #ent-detail-btn, #ent-plus-btn {
      font-family: inherit;
    }
    
    /* コンテンツ詳細モーダル */
    .content-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.7);
      z-index: 2000;
      display: block;
      opacity: 0;
      visibility: hidden;
      backdrop-filter: blur(0px);
      transition: opacity 0.7s cubic-bezier(.4,0,.2,1), backdrop-filter 0.7s cubic-bezier(.4,0,.2,1), visibility 0s 0.7s;
    }
    
    .content-modal-overlay.show {
      opacity: 1;
      visibility: visible;
      backdrop-filter: blur(4px);
      transition: opacity 0.7s cubic-bezier(.4,0,.2,1), backdrop-filter 0.7s cubic-bezier(.4,0,.2,1), visibility 0s;
    }
    
    .content-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, 80px);
      width: 98%;
      max-width: 1400px;
      max-height: 90vh;
      background: #ffffff;
      border-radius: 16px;
      z-index: 2001;
      display: block;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.7s cubic-bezier(.4,0,.2,1), transform 0.7s cubic-bezier(.4,0,.2,1), visibility 0s 0.7s;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }
    
    .content-modal.show {
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, -50%);
      transition: opacity 0.7s cubic-bezier(.4,0,.2,1), transform 0.7s cubic-bezier(.4,0,.2,1), visibility 0s;
    }
    

    
    .content-modal-header {
      position: relative;
      padding: 20px 20px 0 20px;
    }
    
    .content-modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 40px;
      height: 40px;
      background: rgba(0, 0, 0, 0.1);
      border: none;
      border-radius: 50%;
      color: #232323;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      z-index: 3002;
      opacity: 0;
      transform: translateY(-20px);
    }
    
    .content-modal.show .content-modal-close {
      opacity: 1;
      transform: translateY(0);
      transition-delay: 0.5s;
    }
    
    .content-modal-close:hover {
      background: rgba(0, 0, 0, 0.2);
      transform: scale(1.1);
    }
    
    .content-modal-body {
      padding: 0 20px 20px 20px;
      background: #ffffff;
      border-radius: 0 0 16px 16px;
      max-height: calc(90vh - 80px);
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #ccc transparent;
    }
    
    .content-modal-body::-webkit-scrollbar {
      width: 6px;
    }
    
    .content-modal-body::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .content-modal-body::-webkit-scrollbar-thumb {
      background: #ccc;
      border-radius: 3px;
    }
    
    .content-modal-body::-webkit-scrollbar-thumb:hover {
      background: #999;
    }
    
    .content-modal-title {
      font-size: 2.2rem;
      font-weight: 600;
      color: #232323;
      margin: 0 0 8px 0;
      text-align: left;
      opacity: 0;
      transform: translateY(80px);
      transition: opacity 0.7s cubic-bezier(.4,0,.2,1), transform 0.7s cubic-bezier(.4,0,.2,1);
      transition-delay: 0.4s;
    }
    
    .content-modal.show .content-modal-title {
      opacity: 1;
      transform: translateY(0);
    }
    
    .content-modal-category {
      font-size: 1rem;
      color: #666666;
      text-align: left;
      margin-bottom: 16px;
      opacity: 0;
      transform: translateY(80px);
      transition: opacity 0.7s cubic-bezier(.4,0,.2,1), transform 0.7s cubic-bezier(.4,0,.2,1);
      transition-delay: 0.5s;
    }
    
    .content-modal.show .content-modal-category {
      opacity: 1;
      transform: translateY(0);
    }
    
    .content-modal-buttons {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 24px;
      opacity: 0;
      transform: translateY(80px);
      transition: opacity 0.7s cubic-bezier(.4,0,.2,1), transform 0.7s cubic-bezier(.4,0,.2,1);
      transition-delay: 0.6s;
    }
    
    .content-modal.show .content-modal-buttons {
      opacity: 1;
      transform: translateY(0);
    }
    
    .content-modal-btn {
      padding: 16px 32px;
      border: none;
      border-radius: 4px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-family: inherit;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }
    
    .content-modal-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }
    
    .content-modal-btn:hover::before {
      left: 100%;
    }
    
    .content-modal-btn-primary {
      background: #1976d2;
      color: white;
      width: 100%;
    }
    
    .content-modal-btn-primary:hover {
      background: #1565c0;
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(25, 118, 210, 0.3);
    }
    
    .content-modal-btn-row {
      display: flex;
      gap: 12px;
    }
    
    .content-modal-btn-secondary {
      background: #4fc3f7;
      color: white;
      border: none;
      flex: 1;
    }
    
    .content-modal-btn-secondary:hover {
      background: #29b6f6;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(79, 195, 247, 0.3);
    }
    
    .content-modal-btn-outline {
      background: #ffffff;
      color: #1976d2;
      border: 1px solid #1976d2;
      flex: 1;
    }
    
    .content-modal-btn-outline:hover {
      background: #f5f5f5;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(25, 118, 210, 0.2);
    }
    
    .content-modal-image {
      width: 100%;
      height: 300px;
      background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      font-weight: 500;
      position: relative;
      overflow: hidden;
      opacity: 0;
      transform: translateY(80px);
      transition: opacity 0.7s cubic-bezier(.4,0,.2,1), transform 0.7s cubic-bezier(.4,0,.2,1);
      transition-delay: 0.3s;
    }
    
    .content-modal.show .content-modal-image {
      opacity: 1;
      transform: translateY(0);
    }
    
    .content-modal-image::before {
      content: '';
      width: 120px;
      height: 180px;
      background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
      border-radius: 8px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 8px 24px rgba(25, 118, 210, 0.3);
    }
    
    .content-modal-image.has-image::before {
      display: none;
    }
    
    .content-modal-image.has-image {
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }
    
    .content-modal-description {
      font-size: 1rem;
      color: #555555;
      line-height: 1.6;
      text-align: left;
      opacity: 0;
      transform: translateY(80px);
      transition: opacity 0.7s cubic-bezier(.4,0,.2,1), transform 0.7s cubic-bezier(.4,0,.2,1);
      transition-delay: 0.7s;
    }
    
    .content-modal.show .content-modal-description {
      opacity: 1;
      transform: translateY(0);
    }

    /* ライブ配信バッジのアニメーション */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    /* ライブ配信アイテムのスタイル */
    .live-stream-item {
      position: relative;
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .live-stream-item:hover {
      transform: scale(1.05);
    }

    .live-stream-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #ff0000;
      color: #fff;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: 600;
      z-index: 10;
    }
    
    /* 言語選択モーダル */
    .language-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.7);
      z-index: 3000;
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .language-modal-overlay.show {
      display: block;
      opacity: 1;
    }
    
    .language-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      width: 95%;
      max-width: 800px;
      background: #ffffff;
      border-radius: 16px;
      z-index: 3001;
      display: none;
      opacity: 0;
      transition: all 0.3s ease;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }
    
    .language-modal.show {
      display: block;
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }
    
    .language-modal-header {
      position: relative;
      padding: 20px 20px 0 20px;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .language-modal-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #232323;
      margin: 0 0 16px 0;
      text-align: center;
    }
    
    .language-modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 32px;
      height: 32px;
      background: rgba(0, 0, 0, 0.1);
      border: none;
      border-radius: 50%;
      color: #232323;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s ease;
    }
    
    .language-modal-close:hover {
      background: rgba(0, 0, 0, 0.2);
    }
    
    .language-modal-body {
      padding: 20px;
    }
    
    .language-options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .language-option {
      display: flex;
      align-items: center;
      padding: 16px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      background: #ffffff;
    }
    
    .language-option:hover {
      background: #f5f5f5;
      border-color: #1976d2;
    }
    
    .language-option.selected {
      background: #e3f2fd;
      border-color: #1976d2;
    }
    
    .language-option.disabled {
      opacity: 0.3;
      cursor: not-allowed;
      background: #f5f5f5;
    }
    
    .language-option.disabled:hover {
      background: #f5f5f5;
      border-color: #e0e0e0;
    }
    
    .language-option.disabled .language-name,
    .language-option.disabled .language-native {
      color: #999;
    }
    
    .language-flag {
      font-size: 2rem;
      margin-right: 16px;
    }
    
    .language-info {
      flex: 1;
    }
    
    .language-name {
      font-size: 1.1rem;
      font-weight: 500;
      color: #232323;
      margin-bottom: 4px;
    }
    
    .language-native {
      font-size: 0.9rem;
      color: #666666;
    }
    
    .language-check {
      font-size: 1.2rem;
      color: #1976d2;
      font-weight: bold;
      width: 24px;
      text-align: center;
    }
    
    .language-sections-container {
      display: flex;
      gap: 24px;
    }
    
    .language-section {
      flex: 1;
      margin-bottom: 24px;
    }
    
    .language-section-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #232323;
      margin: 0 0 12px 0;
      padding-bottom: 8px;
      border-bottom: 2px solid #e0e0e0;
    }
    
    .language-modal-actions {
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid #e0e0e0;
      text-align: center;
    }
    
    .language-confirm-btn {
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 32px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .language-confirm-btn:hover {
      background: #1565c0;
      transform: translateY(-1px);
    }
  </style>
</head>
<body class="home-modern">
  <script>
    // home.html/map.htmlと同じ下から上へのスライドインアニメーションをhm-mainに適用
    document.addEventListener('DOMContentLoaded', function() {
      var main = document.querySelector('.hm-main');
      if (main) setTimeout(function() { main.classList.add('slideup-animate'); }, 30);

      // --- 明るさ同期 ---
      // localStorage.brightnessPercentがあれば反映
      var brightness = localStorage.getItem('brightnessPercent');
      if (brightness) {
        document.body.style.filter = `brightness(${brightness}%)`;
      }
      // スライダー変更時にlocalStorageへ保存
      var brightnessSlider = document.getElementById('brightness-slider');
      if (brightnessSlider) {
        brightnessSlider.value = brightness || brightnessSlider.value;
        brightnessSlider.oninput = function() {
          document.body.style.filter = `brightness(${this.value}%)`;
          localStorage.setItem('brightnessPercent', this.value);
        };
      }
    });
  </script>
  <!-- 通知パネル（home.htmlと同じ構造） -->
  <div id="notice-overlay" class="settings-overlay"></div>
  <aside id="notice-panel" class="settings-panel">
    <div class="settings-panel-inner">
      <h2 class="settings-title">お知らせ</h2>
      <div class="settings-row">
        <div id="notice-list">
          <div class="settings-note">現在お知らせはありません。</div>
        </div>
      </div>
    </div>
  </aside>
  <!-- 設定パネル（home.htmlと同じ構造） -->
  <div id="settings-overlay" class="settings-overlay"></div>
  <aside id="settings-panel" class="settings-panel">
    <div class="settings-panel-inner">
      <h2 class="settings-title">設定</h2>
      <!-- 音量 -->
      <div class="settings-row">
        <label class="settings-label">音量</label>
        <div class="settings-slider-row">
          <button class="slider-btn" id="volume-down">-</button>
          <input type="range" id="volume-slider" min="0" max="100" value="60">
          <button class="slider-btn" id="volume-up">+</button>
        </div>
      </div>
      <!-- 明るさ -->
      <div class="settings-row">
        <label class="settings-label">画面の明るさ</label>
        <div class="settings-slider-row">
          <button class="slider-btn" id="brightness-down">-</button>
          <input type="range" id="brightness-slider" min="0" max="100" value="75">
          <button class="slider-btn" id="brightness-up">+</button>
        </div>
      </div>
      <!-- 言語 -->
      <div class="settings-row settings-row-flex">
        <label class="settings-label">言語</label>
        <span class="settings-value">日本語</span>
      </div>
      <!-- お知らせ -->
      <div class="settings-row settings-row-flex">
        <label class="settings-label">お知らせ</label>
        <label class="switch">
          <input type="checkbox" id="notice-toggle" checked>
          <span class="slider"></span>
        </label>
      </div>
      <div class="settings-row settings-row-note">
        <span class="settings-note">お知らせ機能のオン/オフ（重要かつ安全に関わるメッセージは表示されます）。</span>
      </div>
      <!-- 保護者制限 -->
      <div class="settings-row settings-row-flex">
        <label class="settings-label">保護者制限</label>
        <span class="settings-value">オフ</span>
      </div>
      <div class="settings-row settings-row-note">
        <span class="settings-note">映画・テレビ番組・ミュージック・オーディオ...</span>
      </div>
      <button class="screen-off-btn">画面オフ</button>
    </div>
  </aside>
  <!-- 画面オフ用オーバーレイ（home.htmlと同じ） -->
  <div id="screen-off-overlay" style="display:none;position:fixed;inset:0;z-index:2147483647;background:#000;opacity:0.98;transition:opacity 0.3s;width:100vw;height:100vh;"></div>
  
  <!-- コンテンツ詳細モーダル -->
  <div id="content-modal-overlay" class="content-modal-overlay"></div>
  <div id="content-modal" class="content-modal">
    <div class="content-modal-header">
      <button class="content-modal-close" onclick="closeContentModal()">×</button>
    </div>
    <div class="content-modal-body">
      <div class="content-modal-image"></div>
      <h2 id="modal-title" class="content-modal-title">Flight TV ep.1</h2>
      <div id="modal-category" class="content-modal-category">2025 ALL カテゴリー</div>
      <div class="content-modal-buttons">
        <button id="modal-play-btn" class="content-modal-btn content-modal-btn-primary"><span class="material-icons">play_arrow</span><span id="modal-play-text">再生する</span></button>
        <div class="content-modal-btn-row">
          <button id="modal-language-btn" class="content-modal-btn content-modal-btn-secondary"><span class="material-icons">language</span><span id="modal-language-text">言語選択をする</span></button>
          <button id="modal-playlist-btn" class="content-modal-btn content-modal-btn-outline"><span class="material-icons">add</span><span id="modal-playlist-text">プレイリストに追加する</span></button>
        </div>
      </div>
      <div id="modal-description" class="content-modal-description">
        ここにエンターテイメントの紹介文章を入力する。ここにエンターテイメントの紹介文章を入力する。ここにエンターテイメントの紹介文章を入力する。<br><br>
        
        Flight TV ep.1は、機内で楽しめる特別なエンターテイメントコンテンツです。このエピソードでは、航空機の歴史や技術について詳しく紹介します。<br><br>
        
        視聴時間：約45分<br>
        言語：日本語、英語、韓国語、中国語対応<br>
        字幕：日本語、英語、韓国語、中国語対応<br><br>
        
        このコンテンツは、機内での快適な時間をお過ごしいただくために特別に制作されました。航空機の安全や快適性について学びながら、楽しい時間をお過ごしください。<br><br>
        
        ご視聴の際は、お好みの言語と字幕を選択してからご覧ください。また、プレイリストに追加することで、後で簡単にアクセスすることができます。
      </div>
    </div>
  </div>

  <!-- 言語選択モーダル -->
  <div id="language-modal-overlay" class="language-modal-overlay"></div>
  <div id="language-modal" class="language-modal">
    <div class="language-modal-header">
      <h3 class="language-modal-title" id="language-modal-title">言語・字幕選択</h3>
      <button class="language-modal-close" onclick="closeLanguageModal()">×</button>
    </div>
    <div class="language-modal-body">
      <div class="language-sections-container">
        <!-- 音声言語選択 -->
        <div class="language-section">
          <h4 class="language-section-title" id="audio-language-title">音声言語</h4>
          <div class="language-options">
            <div class="language-option" onclick="selectAudioLanguage('ja')">
              <div class="language-flag"><span class="material-icons">flag</span></div>
              <div class="language-info">
                <div class="language-name">日本語</div>
                <div class="language-native">Japanese</div>
              </div>
              <div class="language-check" id="audio-ja">✓</div>
            </div>
            <div class="language-option" onclick="selectAudioLanguage('en')">
              <div class="language-flag"><span class="material-icons">flag</span></div>
              <div class="language-info">
                <div class="language-name">English</div>
                <div class="language-native">英語</div>
              </div>
              <div class="language-check" id="audio-en"></div>
            </div>
            <div class="language-option" onclick="selectAudioLanguage('ko')">
              <div class="language-flag"><span class="material-icons">flag</span></div>
              <div class="language-info">
                <div class="language-name">한국어</div>
                <div class="language-native">Korean</div>
              </div>
              <div class="language-check" id="audio-ko"></div>
            </div>
            <div class="language-option" onclick="selectAudioLanguage('zh')">
              <div class="language-flag"><span class="material-icons">flag</span></div>
              <div class="language-info">
                <div class="language-name">中文</div>
                <div class="language-native">Chinese</div>
              </div>
              <div class="language-check" id="audio-zh"></div>
            </div>
          </div>
        </div>
        
        <!-- 字幕言語選択 -->
        <div class="language-section">
          <h4 class="language-section-title" id="subtitle-language-title">字幕言語</h4>
          <div class="language-options">
            <div class="language-option" onclick="selectSubtitleLanguage('ja')">
              <div class="language-flag"><span class="material-icons">flag</span></div>
              <div class="language-info">
                <div class="language-name">日本語</div>
                <div class="language-native">Japanese</div>
              </div>
              <div class="language-check" id="subtitle-ja">✓</div>
            </div>
            <div class="language-option" onclick="selectSubtitleLanguage('en')">
              <div class="language-flag"><span class="material-icons">flag</span></div>
              <div class="language-info">
                <div class="language-name">English</div>
                <div class="language-native">英語</div>
              </div>
              <div class="language-check" id="subtitle-en"></div>
            </div>
            <div class="language-option" onclick="selectSubtitleLanguage('ko')">
              <div class="language-flag"><span class="material-icons">flag</span></div>
              <div class="language-info">
                <div class="language-name">한국어</div>
                <div class="language-native">Korean</div>
              </div>
              <div class="language-check" id="subtitle-ko"></div>
            </div>
            <div class="language-option" onclick="selectSubtitleLanguage('zh')">
              <div class="language-flag"><span class="material-icons">flag</span></div>
              <div class="language-info">
                <div class="language-name">中文</div>
                <div class="language-native">Chinese</div>
              </div>
              <div class="language-check" id="subtitle-zh"></div>
            </div>
            <div class="language-option" onclick="selectSubtitleLanguage('off')">
              <div class="language-flag"><span class="material-icons">block</span></div>
              <div class="language-info">
                <div class="language-name" id="subtitle-off-name">字幕なし</div>
                <div class="language-native" id="subtitle-off-native">Off</div>
              </div>
              <div class="language-check" id="subtitle-off"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 確定ボタン -->
      <div class="language-modal-actions">
        <button class="language-confirm-btn" id="language-confirm-btn" onclick="confirmLanguageSelection()">確定</button>
      </div>
    </div>
  </div>
  <!-- ヘッダー（home.htmlと統一） -->
  <div class="hm-header">
    <div class="hm-flight-info" style="color:#fff;">
      <span id="hm-seat"></span>
      <span id="hm-route"></span>
    </div>
    <div class="hm-header-icons">
      <button class="hm-dot hm-btn-home" title="ホーム" style="display:flex;align-items:center;justify-content:center;font-size:1.7rem;"><span class="material-icons">home</span></button>
      <button class="hm-dot hm-btn-notice" title="お知らせ" style="display:flex;align-items:center;justify-content:center;font-size:1.7rem;"><span class="material-icons">chat</span></button>
      <button class="hm-dot hm-btn-attendant" title="客室乗務員呼び出し" style="display:flex;align-items:center;justify-content:center;font-size:1.7rem;"><span class="material-icons">support_agent</span></button>
      <button class="hm-dot hm-btn-settings" title="設定" style="display:flex;align-items:center;justify-content:center;font-size:1.7rem;"><span class="material-icons">settings</span></button>
    </div>
  </div>
  <!-- メイン -->
  <div class="hm-main" style="background:#232323;flex-direction:column;">
    <!-- コンテンツエリア -->
    <div class="entertainment-content-scroll">
      <!-- 今月の最新作セクション -->
      <div style="background:#18191c; border-radius: 16px; margin-bottom: 32px; padding: 32px;">
        <h1 id="ent-title" style="font-size:3.2rem;font-weight:500;margin-bottom:18px;color:#fff;"></h1>
        <div id="ent-desc" style="font-size:1.25rem;opacity:0.92;margin-bottom:32px;color:#e0e0e0;"></div>
        <div style="display:flex;gap:18px;margin-bottom:36px;">
          <button id="ent-watch-btn" style="background:#1976d2;color:#fff;font-size:1.15rem;padding:12px 32px;border:none;border-radius:4px;"></button>
          <button id="ent-detail-btn" style="background:transparent;color:#fff;font-size:1.15rem;padding:12px 32px;border:1.5px solid #fff;border-radius:4px;"></button>
          <button id="ent-plus-btn" style="background:transparent;color:#fff;font-size:1.15rem;padding:12px 24px;border:1.5px solid #fff;border-radius:4px;"></button>
        </div>
      </div>
      <!-- 人気作品セクション -->
      <div style="background:#fff;padding:32px; border-radius: 16px; margin-bottom: 32px;">
        <div id="ent-popular-title" style="font-size:1.8rem;color:#232323;margin-bottom:18px;font-weight:500;"></div>
        <div id="popular-content-container"></div>
        </div>

      <!-- ライブ配信セクション -->
      <div style="background:#fff;padding:32px; border-radius: 16px; margin-bottom: 32px;">
        <div style="font-size:1.8rem;color:#232323;margin-bottom:18px;font-weight:500;display:flex;align-items:center;gap:12px;">
          <span>ライブ配信</span>
          <span style="background:#ff0000;color:#fff;padding:4px 8px;border-radius:12px;font-size:0.8rem;font-weight:600;animation:pulse 2s infinite;">LIVE</span>
      </div>
        <div id="live-stream-container"></div>
      </div>

      <!-- おすすめTV番組セクション（追加） -->
      <div style="background:#fff;padding:32px; border-radius: 16px; margin-bottom: 32px;">
        <div id="ent-recommended-title" style="font-size:1.8rem;color:#232323;margin-bottom:18px;font-weight:500;"></div>
        <div id="recommended-content-container"></div>
        </div>

      <!-- 最新映画セクション -->
      <div style="background:#fff;padding:32px; border-radius: 16px; margin-bottom: 32px;">
        <div style="font-size:1.8rem;color:#232323;margin-bottom:18px;font-weight:500;">最新映画</div>
        <div id="latest-movies-container"></div>
      </div>

      <!-- アニメセクション -->
      <div style="background:#fff;padding:32px; border-radius: 16px; margin-bottom: 32px;">
        <div style="font-size:1.8rem;color:#232323;margin-bottom:18px;font-weight:500;">アニメ</div>
        <div id="anime-container"></div>
      </div>
    </div>
  </div>
  <!-- フッター（home.htmlと統一） -->
  <div class="hm-footer">
    <div class="hm-footer-col">
      <div class="hm-footer-label" id="hm-dep-label">KIX 出発時刻</div>
      <div class="hm-footer-time" id="hm-dep-time">19:10</div>
    </div>
    <div class="hm-footer-progress">
      <div class="hm-progress-bar-bg">
        <div class="hm-progress-bar" id="hm-progress-bar"></div>
        <div class="hm-plane-icon"></div>
      </div>
    </div>
    <div class="hm-footer-col hm-footer-col-right">
      <div class="hm-footer-label" id="hm-arr-label">ICN 到着時刻</div>
      <div class="hm-footer-time" id="hm-arr-time">21:00</div>
    </div>
  </div>
  <script>
    // --- home.htmlと同じ通知・設定パネル制御 ---
    // ヘッダーの座席・空港ID表示 & 言語設定同期
    document.addEventListener('DOMContentLoaded', function() {
      // ヘッダー
      const seat = localStorage.getItem('seatNumber') || '31A';
      const departureID = localStorage.getItem('departureID') || 'KIX';
      const arrivalID = localStorage.getItem('arrivalID') || 'ICN';
      const seatEl = document.getElementById('hm-seat');
      const routeEl = document.getElementById('hm-route');
      if (seatEl) seatEl.textContent = seat;
      if (routeEl) routeEl.textContent = `${departureID} – ${arrivalID}`;

      // ホームボタン押下時の挙動（home.htmlに遷移）
      const homeBtn = document.querySelector('.hm-btn-home');
      if (homeBtn) {
        homeBtn.onclick = function() {
          window.location.href = 'home.html';
        };
      }

      // 客室乗務員呼び出しボタン押下時の挙動（ダイアログ表示）
      const attendantBtn = document.querySelector('.hm-btn-attendant');
      if (attendantBtn) {
        attendantBtn.onclick = function() {
          alert('客室乗務員をお呼び出しします。しばらくお待ちください。');
        };
      }

      // 言語切替（home.htmlと同期: localStorage.language）
      const langNames = { ja: '日本語', en: 'English', ko: '한국어', zh: '中文' };
      const langSpan = document.querySelector('.settings-row .settings-value');
      function setLangUI() {
        const langValue = localStorage.getItem('language') || 'ja';
        if (langSpan) langSpan.textContent = langNames[langValue] || langValue;
        // i18n.jsの形式に合わせてwindow.i18n[langValue]またはwindow.i18n["ja"]を参照
        const i18n = window.i18n && (window.i18n[langValue] || window.i18n['ja']);
        if (i18n) {
          // 言語選択モーダルの多言語化
          const languageModalTitle = document.getElementById('language-modal-title');
          const audioLanguageTitle = document.getElementById('audio-language-title');
          const subtitleLanguageTitle = document.getElementById('subtitle-language-title');
          const subtitleOffName = document.getElementById('subtitle-off-name');
          const subtitleOffNative = document.getElementById('subtitle-off-native');
          const languageConfirmBtn = document.getElementById('language-confirm-btn');

          if (languageModalTitle) languageModalTitle.textContent = i18n.language_modal_title || '言語・字幕選択';
          if (audioLanguageTitle) audioLanguageTitle.textContent = i18n.audio_language_title || '音声言語';
          if (subtitleLanguageTitle) subtitleLanguageTitle.textContent = i18n.subtitle_language_title || '字幕言語';
          if (subtitleOffName) subtitleOffName.textContent = i18n.subtitle_off || '字幕なし';
          if (subtitleOffNative) subtitleOffNative.textContent = i18n.subtitle_off || 'Off';
          if (languageConfirmBtn) languageConfirmBtn.textContent = i18n.confirm || '確定';

          // コンテンツモーダルの多言語化
          const modalPlayText = document.getElementById('modal-play-text');
          const modalLanguageText = document.getElementById('modal-language-text');
          const modalPlaylistText = document.getElementById('modal-playlist-text');

          if (modalPlayText) modalPlayText.textContent = i18n.play || '再生する';
          if (modalLanguageText) modalLanguageText.textContent = i18n.select_language || '言語選択をする';
          if (modalPlaylistText) modalPlaylistText.textContent = i18n.add_to_playlist || 'プレイリストに追加する';
          // メイン
          const h1 = document.getElementById('ent-title');
          if (h1) h1.textContent = i18n.ent_new_this_month || i18n.latest_this_month || '今月の最新作';
          const desc = document.getElementById('ent-desc');
          if (desc) desc.textContent = i18n.ent_new_this_month_desc || i18n.enjoy_latest_movies || '機内で最新の映画・番組を楽しもう！ハリウッドの話題作から外国作品まで見どころを一挙紹介';
          const btnWatch = document.getElementById('ent-watch-btn');
          if (btnWatch) btnWatch.textContent = i18n.ent_watch_now || i18n.watch_now || '今すぐ見る';
          const btnDetail = document.getElementById('ent-detail-btn');
          if (btnDetail) btnDetail.textContent = i18n.ent_detail || i18n.details || '詳細';
          const btnPlus = document.getElementById('ent-plus-btn');
          if (btnPlus) btnPlus.textContent = i18n.ent_plus || i18n.plus || '＋';
          const popTitle = document.getElementById('ent-popular-title');
          if (popTitle) popTitle.textContent = i18n.ent_popular_title || i18n.popular_among_users || 'AirPlane Systems 利用者の中での人気作品';
          const popMain = document.getElementById('ent-popular-main');
          if (popMain) popMain.textContent = i18n.ent_flight_tv_title || 'Flight TV';
          const popEp = document.getElementById('ent-popular-ep');
          if (popEp) popEp.textContent = i18n.ent_flight_tv_ep1 || i18n.flight_tv_ep1 || 'Flight TV ep.1';
          // 追加セクション
          const recTitle = document.getElementById('ent-recommended-title');
          if (recTitle) recTitle.textContent = i18n.ent_recommended_title || 'おすすめのテレビ番組';
          const recMain = document.getElementById('ent-recommended-main');
          if (recMain) recMain.textContent = i18n.ent_recommended_main || 'ドラマシリーズ';
          const recEp = document.getElementById('ent-recommended-ep');
          if (recEp) recEp.textContent = i18n.ent_recommended_ep || '第1話';
          // ライブ配信セクション
          const liveTitle = document.querySelector('#live-stream-container').previousElementSibling.querySelector('span:first-child');
          if (liveTitle) liveTitle.textContent = i18n.ent_live_streams || 'ライブ配信';
          // フッター
          const depLabel = document.getElementById('hm-dep-label');
          const arrLabel = document.getElementById('hm-arr-label');
          const departureID = localStorage.getItem('departureID') || 'KIX';
          const arrivalID = localStorage.getItem('arrivalID') || 'ICN';
          if (depLabel) depLabel.textContent = `${departureID} ${(i18n && (i18n.departure || i18n.dep_time)) || '出発時刻'}`;
          if (arrLabel) arrLabel.textContent = `${arrivalID} ${(i18n && (i18n.arrival || i18n.arr_time)) || '到着時刻'}`;

          // 設定・通知パネル
          // タイトル
          const settingsTitles = document.querySelectorAll('.settings-title');
          if (settingsTitles && settingsTitles.length > 0) {
            // 1つ目: 設定, 2つ目: お知らせ
            if (settingsTitles[0]) settingsTitles[0].textContent = i18n.settings || '設定';
            if (settingsTitles[1]) settingsTitles[1].textContent = i18n.notice || 'お知らせ';
          }
          // ラベル
          const settingsLabels = document.querySelectorAll('.settings-label');
          if (settingsLabels && settingsLabels.length >= 5) {
            settingsLabels[0].textContent = i18n.volume || '音量';
            settingsLabels[1].textContent = i18n.brightness || '画面の明るさ';
            settingsLabels[2].textContent = i18n.language || '言語';
            settingsLabels[3].textContent = i18n.notice || 'お知らせ';
            settingsLabels[4].textContent = i18n.parental || '保護者制限';
          }
          // 言語・保護者制限値
          const settingsValues = document.querySelectorAll('.settings-value');
          if (settingsValues && settingsValues.length >= 2) {
            // 言語
            const langNames = { ja: '日本語', en: 'English', ko: '한국어', zh: '中文' };
            settingsValues[0].textContent = langNames[langValue] || langValue;
            // 保護者制限
            settingsValues[1].textContent = i18n.parental_off || 'オフ';
          }
          // お知らせ説明
          const settingsNotes = document.querySelectorAll('.settings-note');
          if (settingsNotes && settingsNotes.length > 0) {
            // 1つ目: お知らせ説明, 2つ目: 保護者制限説明, 3つ目: お知らせパネル空
            if (settingsNotes[0]) settingsNotes[0].textContent = i18n.notice_note || 'お知らせ機能のオン/オフ（重要かつ安全に関わるメッセージは表示されます）。';
            if (settingsNotes[1]) settingsNotes[1].textContent = i18n.parental_note || '映画・テレビ番組・ミュージック・オーディオ...';
            if (settingsNotes[2]) settingsNotes[2].textContent = i18n.notice_empty || '現在お知らせはありません。';
          }
          // 画面オフボタン
          const screenOffBtn = document.querySelector('.screen-off-btn');
          if (screenOffBtn) screenOffBtn.textContent = i18n.screen_off || '画面オフ';
          // お知らせパネルの空表示（冗長だが念のため）
          const noticeList = document.getElementById('notice-list');
          if (noticeList && noticeList.children.length === 1 && noticeList.firstElementChild.classList.contains('settings-note')) {
            noticeList.firstElementChild.textContent = i18n.notice_empty || '現在お知らせはありません。';
          }
        }
      }
      setLangUI();
      if (langSpan) {
        langSpan.style.cursor = 'pointer';
        langSpan.onclick = function() {
          const langs = ['ja', 'en', 'ko', 'zh'];
          const current = localStorage.getItem('language') || 'ja';
          let idx = langs.indexOf(current);
          idx = (idx + 1) % langs.length;
          localStorage.setItem('language', langs[idx]);
          setLangUI();
        };
      }
    });

    // 通知パネル制御
    const noticeBtn = document.querySelector('.hm-btn-notice');
    const noticePanel = document.getElementById('notice-panel');
    const noticeOverlay = document.getElementById('notice-overlay');
    if (noticeBtn && noticePanel && noticeOverlay) {
      noticeBtn.onclick = () => {
        noticePanel.classList.add('open');
        noticeOverlay.classList.add('open');
      };
      noticeOverlay.onclick = () => {
        noticePanel.classList.remove('open');
        noticeOverlay.classList.remove('open');
      };
      document.addEventListener('keydown', e => {
        if (e.key === 'Escape') {
          noticePanel.classList.remove('open');
          noticeOverlay.classList.remove('open');
        }
      });
    }
    // 設定パネル制御
    const settingsBtn = document.querySelector('.hm-btn-settings');
    const settingsPanel = document.getElementById('settings-panel');
    const settingsOverlay = document.getElementById('settings-overlay');
    if (settingsBtn && settingsPanel && settingsOverlay) {
      settingsBtn.onclick = () => {
        settingsPanel.classList.add('open');
        settingsOverlay.classList.add('open');
      };
      settingsOverlay.onclick = () => {
        settingsPanel.classList.remove('open');
        settingsOverlay.classList.remove('open');
      };
      document.addEventListener('keydown', e => {
        if (e.key === 'Escape') {
          settingsPanel.classList.remove('open');
          settingsOverlay.classList.remove('open');
        }
      });
    }
    // スライダーの+-ボタン
    function stepSlider(sliderId, diff) {
      const slider = document.getElementById(sliderId);
      slider.value = Math.max(Number(slider.min), Math.min(Number(slider.max), Number(slider.value) + diff));
      slider.dispatchEvent(new Event('input'));
    }
    const volumeDown = document.getElementById('volume-down');
    const volumeUp = document.getElementById('volume-up');
    const volumeSlider = document.getElementById('volume-slider');
    if (volumeDown && volumeSlider) volumeDown.onclick = () => stepSlider('volume-slider', -5);
    if (volumeUp && volumeSlider) volumeUp.onclick = () => stepSlider('volume-slider', 5);
    // 明るさ同期・スライダー制御
    document.addEventListener('DOMContentLoaded', function() {
      var brightness = localStorage.getItem('brightnessPercent');
      if (brightness) {
        document.body.style.filter = `brightness(${brightness}%)`;
      }
      var brightnessSlider = document.getElementById('brightness-slider');
    if (brightnessSlider) {
        brightnessSlider.value = brightness || brightnessSlider.value;
      brightnessSlider.oninput = function() {
        document.body.style.filter = `brightness(${this.value}%)`;
          localStorage.setItem('brightnessPercent', this.value);
        };
      }
      var brightnessDown = document.getElementById('brightness-down');
      var brightnessUp = document.getElementById('brightness-up');
      if (brightnessDown && brightnessSlider) brightnessDown.onclick = () => {
        brightnessSlider.value = Math.max(Number(brightnessSlider.min), Number(brightnessSlider.value) - 5);
        brightnessSlider.dispatchEvent(new Event('input'));
      };
      if (brightnessUp && brightnessSlider) brightnessUp.onclick = () => {
        brightnessSlider.value = Math.min(Number(brightnessSlider.max), Number(brightnessSlider.value) + 5);
        brightnessSlider.dispatchEvent(new Event('input'));
      };
    });
    // 画面オフボタン
    const screenOffBtn = document.querySelector('.screen-off-btn');
    const screenOffOverlay = document.getElementById('screen-off-overlay');
    if (screenOffBtn && screenOffOverlay) {
      screenOffBtn.onclick = () => {
        screenOffOverlay.style.display = 'block';
        setTimeout(() => { screenOffOverlay.style.opacity = '0.98'; }, 10);
      };
      screenOffOverlay.onclick = () => {
        screenOffOverlay.style.opacity = '0';
        setTimeout(() => { screenOffOverlay.style.display = 'none'; }, 300);
      };
    }
    // 多言語UI反映（home.htmlのロジックを流用する場合はここに追加）

    // コンテンツを動的に生成する関数
    function renderContent() {
      // 人気作品セクション
      const popularContainer = document.getElementById('popular-content-container');
      if (popularContainer && contentData.popular.items.length > 0) {
        const item = contentData.popular.items[0];
        const coverStyle = item.coverImage ? 
          `background-image: url('${item.coverImage}'); background-size: cover; background-position: center;` : 
          `background: ${item.backgroundColor};`;
        
        popularContainer.innerHTML = `
          <div class="clickable-content-item" data-title="${item.title}" data-category="${item.category}" data-description="${item.description.replace(/"/g, '&quot;')}">
            <div style="${coverStyle}color:#fff;font-size:2rem;text-align:center;width:320px;aspect-ratio:16/9;display:flex;align-items:center;justify-content:center;border-radius:8px;position:relative;cursor:pointer;">
              ${!item.coverImage ? `<span style="z-index:1;">${item.title}</span>` : ''}
            </div>
            <div style="font-size:1.1rem;color:#232323;margin-top:8px;margin-left:4px;">${item.episode}</div>
          </div>
        `;
        
        // クリックイベントを追加
        const clickableItem = popularContainer.querySelector('.clickable-content-item');
        clickableItem.addEventListener('click', function() {
          console.log('Popular item clicked!');
          const title = this.getAttribute('data-title');
          const category = this.getAttribute('data-category');
          const description = this.getAttribute('data-description');
          console.log('Data:', { title, category, description: description.substring(0, 50) + '...' });
          openContentModal(title, category, description);
        });
        
        // カバー画像がある場合はタイトルをオーバーレイとして表示
        if (item.coverImage) {
          const coverDiv = popularContainer.querySelector('div[style*="background-image"]');
          const overlayDiv = document.createElement('div');
          overlayDiv.style.cssText = 'position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,0.7);color:#fff;padding:8px;font-size:1.2rem;text-align:center;border-radius:0 0 8px 8px;';
          overlayDiv.textContent = item.title;
          coverDiv.appendChild(overlayDiv);
        }
      }

      // おすすめ作品セクション
      const recommendedContainer = document.getElementById('recommended-content-container');
      if (recommendedContainer && contentData.recommended.items.length > 0) {
        const item = contentData.recommended.items[0];
        const coverStyle = item.coverImage ? 
          `background-image: url('${item.coverImage}'); background-size: cover; background-position: center;` : 
          `background: ${item.backgroundColor};`;
        
        recommendedContainer.innerHTML = `
          <div style="display:flex;flex-direction:column;align-items:flex-start;gap:0;" data-title="${item.title}" data-category="${item.category}" data-description="${item.description.replace(/"/g, '&quot;')}">
            <div style="${coverStyle}color:#fff;font-size:2rem;text-align:center;width:320px;aspect-ratio:16/9;display:flex;align-items:center;justify-content:center;border-radius:8px;cursor:pointer;position:relative;">
              ${!item.coverImage ? `<span style="z-index:1;">${item.title}</span>` : ''}
            </div>
            <div style="font-size:1.1rem;color:#232323;margin-top:8px;margin-left:4px;">${item.episode}</div>
          </div>
        `;
        
        // クリックイベントを追加
        const clickableItem = recommendedContainer.querySelector('div[data-title]');
        clickableItem.addEventListener('click', function() {
          const title = this.getAttribute('data-title');
          const category = this.getAttribute('data-category');
          const description = this.getAttribute('data-description');
          openContentModal(title, category, description);
        });
        
        // カバー画像がある場合はタイトルをオーバーレイとして表示
        if (item.coverImage) {
          const coverDiv = recommendedContainer.querySelector('div[style*="background-image"]');
          const overlayDiv = document.createElement('div');
          overlayDiv.style.cssText = 'position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,0.7);color:#fff;padding:8px;font-size:1.2rem;text-align:center;border-radius:0 0 8px 8px;';
          overlayDiv.textContent = item.title;
          coverDiv.appendChild(overlayDiv);
        }
      }

      // 最新映画セクション
      const latestMoviesContainer = document.getElementById('latest-movies-container');
      if (latestMoviesContainer && contentData.latestMovies.items.length > 0) {
        latestMoviesContainer.innerHTML = `
          <div style="display:flex;gap:24px;flex-wrap:wrap;">
            ${contentData.latestMovies.items.map(item => {
              const coverStyle = item.coverImage ? 
                `background-image: url('${item.coverImage}'); background-size: cover; background-position: center;` : 
                `background: ${item.backgroundColor};`;
              
              return `
                <div class="clickable-content-item" data-title="${item.title}" data-category="${item.category}" data-description="${item.description.replace(/"/g, '&quot;')}">
                  <div style="${coverStyle}color:#fff;font-size:1.5rem;text-align:center;width:200px;aspect-ratio:16/9;display:flex;align-items:center;justify-content:center;border-radius:8px;cursor:pointer;position:relative;">
                    ${!item.coverImage ? `<span style="z-index:1;">${item.title}</span>` : ''}
                  </div>
                  <div style="font-size:1rem;color:#232323;margin-top:8px;margin-left:4px;">${item.genre}</div>
                </div>
              `;
            }).join('')}
          </div>
        `;
        
        // クリックイベントを追加
        const clickableItems = latestMoviesContainer.querySelectorAll('.clickable-content-item');
        clickableItems.forEach(item => {
          item.addEventListener('click', function() {
            const title = this.getAttribute('data-title');
            const category = this.getAttribute('data-category');
            const description = this.getAttribute('data-description');
            openContentModal(title, category, description);
          });
        });
        
        // カバー画像がある作品にタイトルオーバーレイを追加
        contentData.latestMovies.items.forEach((item, index) => {
          if (item.coverImage) {
            const coverDivs = latestMoviesContainer.querySelectorAll('div[style*="background-image"]');
            if (coverDivs[index]) {
              const overlayDiv = document.createElement('div');
              overlayDiv.style.cssText = 'position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,0.7);color:#fff;padding:6px;font-size:1rem;text-align:center;border-radius:0 0 8px 8px;';
              overlayDiv.textContent = item.title;
              coverDivs[index].appendChild(overlayDiv);
            }
          }
        });
      }

      // アニメセクション
      const animeContainer = document.getElementById('anime-container');
      if (animeContainer && contentData.anime.items.length > 0) {
        animeContainer.innerHTML = `
          <div style="display:flex;gap:24px;flex-wrap:wrap;">
            ${contentData.anime.items.map(item => {
              const coverStyle = item.coverImage ? 
                `background-image: url('${item.coverImage}'); background-size: cover; background-position: center;` : 
                `background: ${item.backgroundColor};`;
              
              return `
                <div class="clickable-content-item" data-title="${item.title}" data-category="${item.category}" data-description="${item.description.replace(/"/g, '&quot;')}">
                  <div style="${coverStyle}color:#fff;font-size:1.5rem;text-align:center;width:200px;aspect-ratio:16/9;display:flex;align-items:center;justify-content:center;border-radius:8px;cursor:pointer;position:relative;">
                    ${!item.coverImage ? `<span style="z-index:1;">${item.title}</span>` : ''}
                  </div>
                  <div style="font-size:1rem;color:#232323;margin-top:8px;margin-left:4px;">${item.genre}</div>
                </div>
              `;
            }).join('')}
          </div>
        `;
        
        // クリックイベントを追加
        const clickableItems = animeContainer.querySelectorAll('.clickable-content-item');
        clickableItems.forEach(item => {
          item.addEventListener('click', function() {
            const title = this.getAttribute('data-title');
            const category = this.getAttribute('data-category');
            const description = this.getAttribute('data-description');
            openContentModal(title, category, description);
          });
        });
        
        // カバー画像がある作品にタイトルオーバーレイを追加
        contentData.anime.items.forEach((item, index) => {
          if (item.coverImage) {
            const coverDivs = animeContainer.querySelectorAll('div[style*="background-image"]');
            if (coverDivs[index]) {
              const overlayDiv = document.createElement('div');
              overlayDiv.style.cssText = 'position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,0.7);color:#fff;padding:6px;font-size:1rem;text-align:center;border-radius:0 0 8px 8px;';
              overlayDiv.textContent = item.title;
              coverDivs[index].appendChild(overlayDiv);
            }
          }
        });
      }

      // ライブ配信セクション
      const liveStreamContainer = document.getElementById('live-stream-container');
      console.log('liveStreamContainer:', liveStreamContainer);
      console.log('contentData.liveStreams:', contentData.liveStreams);
      if (liveStreamContainer) {
        if (contentData.liveStreams && contentData.liveStreams.items && contentData.liveStreams.items.length > 0) {
          liveStreamContainer.innerHTML = `
            <div style="display:flex;gap:24px;flex-wrap:wrap;">
              ${contentData.liveStreams.items.map(item => {
                const coverStyle = item.coverImage ? 
                  `background-image: url('${item.coverImage}'); background-size: cover; background-position: center;` : 
                  `background: ${item.backgroundColor || '#ff0000'};`;
                return `
                  <div class="live-stream-item clickable-content-item" data-title="${item.title}" data-category="${item.category}" data-description="${item.description.replace(/\"/g, '&quot;')}" data-live-id="${item.id}">
                    <div style="${coverStyle}color:#fff;font-size:1.5rem;text-align:center;width:200px;aspect-ratio:16/9;display:flex;align-items:center;justify-content:center;border-radius:8px;cursor:pointer;position:relative;">
                      ${!item.coverImage ? `<span style="z-index:1;">${item.title}</span>` : ''}
                      <div class="live-stream-badge">LIVE</div>
                    </div>
                    <div style="font-size:1rem;color:#232323;margin-top:8px;margin-left:4px;">${item.genre || 'ライブ配信'}</div>
                  </div>
                `;
              }).join('')}
            </div>
          `;
          // クリックイベントを追加
          const liveStreamItems = liveStreamContainer.querySelectorAll('.live-stream-item');
          liveStreamItems.forEach(item => {
            item.addEventListener('click', function() {
              const title = this.getAttribute('data-title');
              const category = this.getAttribute('data-category');
              const description = this.getAttribute('data-description');
              const liveId = this.getAttribute('data-live-id');
              console.log('ライブ配信クリック:', { title, category, description, liveId });
              if (liveId) {
                openLiveStreamModal(title, category, description, liveId);
              } else {
                openContentModal(title, category, description);
              }
            });
          });
          // カバー画像がある作品にタイトルオーバーレイを追加
          contentData.liveStreams.items.forEach((item, index) => {
            if (item.coverImage) {
              const coverDivs = liveStreamContainer.querySelectorAll('div[style*="background-image"]');
              if (coverDivs[index]) {
                const overlayDiv = document.createElement('div');
                overlayDiv.style.cssText = 'position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,0.7);color:#fff;padding:6px;font-size:1rem;text-align:center;border-radius:0 0 8px 8px;';
                overlayDiv.textContent = item.title;
                coverDivs[index].appendChild(overlayDiv);
              }
            }
          });
        } else {
          liveStreamContainer.innerHTML = '<div style="color:#888;font-size:1.1rem;">現在ライブ配信はありません。</div>';
        }
      }
    }

    // コンテンツ詳細モーダル制御
    function openContentModal(title, category, description) {
      console.log('openContentModal called:', title, category);
      
      document.getElementById('modal-title').textContent = title;
      document.getElementById('modal-category').textContent = category;
      document.getElementById('modal-description').innerHTML = description.replace(/\n/g, '<br>');
      
      // コンテンツデータから画像を検索・設定
      const allItems = [
        ...getContentData.getAllPopular(),
        ...getContentData.getAllRecommended(),
        ...getContentData.getAllLatestMovies(),
        ...getContentData.getAllAnime(),
        ...getContentData.getAllLiveStreams()
      ];
      
      const content = allItems.find(item => 
        item.title === title && item.category === category
      );
      
      const modalImage = document.querySelector('.content-modal-image');
      if (modalImage) {
        if (content && content.coverImage) {
          // 画像の読み込みをテスト
          const testImage = new Image();
          testImage.crossOrigin = 'anonymous'; // CORS対応
          
          testImage.onload = function() {
            modalImage.style.backgroundImage = `url(${content.coverImage})`;
            modalImage.classList.add('has-image');
            console.log('画像を設定:', content.coverImage);
          };
          
          testImage.onerror = function() {
            console.log('画像の読み込みに失敗:', content.coverImage);
            // デフォルト画像を設定
            modalImage.style.backgroundImage = 'url(image/default-cover.jpg)';
            modalImage.classList.add('has-image');
          };
          
          testImage.src = content.coverImage;
        } else {
          modalImage.style.backgroundImage = 'none';
          modalImage.classList.remove('has-image');
          console.log('画像が見つかりません');
        }
      }
      
      const overlay = document.getElementById('content-modal-overlay');
      const modal = document.getElementById('content-modal');
      
      console.log('Overlay element:', overlay);
      console.log('Modal element:', modal);
      
      // まずオーバーレイを表示
      overlay.classList.add('show');
      
      // 少し遅延してからモーダルを表示（アニメーション効果のため）
      setTimeout(() => {
        modal.classList.add('show');
        console.log('Modal should be visible now');
      }, 50);
    }

    // ライブ配信専用モーダル制御
    function openLiveStreamModal(title, category, description, liveId) {
      console.log('openLiveStreamModal called:', title, category, liveId);
      
      document.getElementById('modal-title').textContent = title;
      document.getElementById('modal-category').textContent = category + ' (ライブ配信)';
      document.getElementById('modal-description').innerHTML = description.replace(/\n/g, '<br>');
      
      // ライブ配信データから画像を検索・設定
      const liveStreams = getContentData.getAllLiveStreams();
      const liveContent = liveStreams.find(item => item.id === liveId);
      
      const modalImage = document.querySelector('.content-modal-image');
      if (modalImage) {
        if (liveContent && liveContent.coverImage) {
          // 画像の読み込みをテスト
          const testImage = new Image();
          testImage.crossOrigin = 'anonymous'; // CORS対応
          
          testImage.onload = function() {
            modalImage.style.backgroundImage = `url(${liveContent.coverImage})`;
            modalImage.classList.add('has-image');
            console.log('ライブ配信画像を設定:', liveContent.coverImage);
          };
          
          testImage.onerror = function() {
            console.log('ライブ配信画像の読み込みに失敗:', liveContent.coverImage);
            // ライブ配信用のデフォルト画像を設定
            modalImage.style.backgroundImage = 'url(image/live-stream-default.jpg)';
            modalImage.classList.add('has-image');
          };
          
          testImage.src = liveContent.coverImage;
        } else {
          // ライブ配信用のデフォルト画像を設定
          modalImage.style.backgroundImage = 'url(image/live-stream-default.jpg)';
          modalImage.classList.add('has-image');
          console.log('ライブ配信デフォルト画像を設定');
        }
      }
      
      // ライブ配信用のボタンテキストを変更
      const playBtn = document.getElementById('modal-play-btn');
      if (playBtn) {
        playBtn.innerHTML = '<span class="material-icons">live_tv</span><span id="modal-play-text">ライブ配信を見る</span>';
      }
      
      const overlay = document.getElementById('content-modal-overlay');
      const modal = document.getElementById('content-modal');
      
      // まずオーバーレイを表示
      overlay.classList.add('show');
      
      // 少し遅延してからモーダルを表示
      setTimeout(() => {
        modal.classList.add('show');
        console.log('Live stream modal should be visible now');
      }, 50);
      
      // ライブ配信IDを保存
      modal.setAttribute('data-live-id', liveId);
    }
    
    function closeContentModal() {
      const overlay = document.getElementById('content-modal-overlay');
      const modal = document.getElementById('content-modal');
      
      // 画像をリセット
      const modalImage = document.querySelector('.content-modal-image');
      if (modalImage) {
        modalImage.style.backgroundImage = 'none';
        modalImage.classList.remove('has-image');
      }
      
      // ライブ配信IDをクリア
      modal.removeAttribute('data-live-id');
      
      // ボタンテキストをリセット
      const playBtn = document.getElementById('modal-play-btn');
      if (playBtn) {
        playBtn.innerHTML = '<span class="material-icons">play_arrow</span><span id="modal-play-text">再生する</span>';
      }
      
      // モーダルとオーバーレイを同時に非表示
      modal.classList.remove('show');
      overlay.classList.remove('show');
    }
    
    // ページ読み込み時の初期化
    document.addEventListener('DOMContentLoaded', function() {
      // コンテンツをレンダリング
      renderContent();
      
      // オーバーレイクリックでモーダルを閉じる
      document.getElementById('content-modal-overlay').addEventListener('click', function(e) {
        if (e.target === this) {
          closeContentModal();
        }
      });
      
      // 再生ボタン
      document.getElementById('modal-play-btn').addEventListener('click', function() {
        // ライブ配信IDが設定されているかチェック
        const modal = document.getElementById('content-modal');
        const liveId = modal.getAttribute('data-live-id');
        
        if (liveId) {
          // ライブ配信の場合はetl-movie.htmlに遷移
          window.location.href = `player/etl-movie.html?id=${liveId}`;
        } else {
          // 通常の動画の場合はet-movie.htmlに遷移
          const modalTitle = document.getElementById('modal-title').textContent;
          const modalCategory = document.getElementById('modal-category').textContent;
          
          // コンテンツIDを検索
          let contentId = null;
          const allItems = [
            ...getContentData.getAllPopular(),
            ...getContentData.getAllRecommended(),
            ...getContentData.getAllLatestMovies(),
            ...getContentData.getAllAnime()
          ];
          
          const content = allItems.find(item => 
            item.title === modalTitle && item.category === modalCategory
          );
          
          if (content) {
            contentId = content.id;
            // player/et-movie.htmlに遷移
            window.location.href = `player/et-movie.html?id=${contentId}`;
          } else {
            alert('コンテンツ情報が見つかりません。');
          }
        }
        
        closeContentModal();
      });
      
      // 言語選択ボタン
      document.getElementById('modal-language-btn').addEventListener('click', function() {
        openLanguageModal();
      });
      
      // プレイリスト追加ボタン
      document.getElementById('modal-playlist-btn').addEventListener('click', function() {
        alert('プレイリストに追加しました。');
      });
      
      // 言語選択モーダルのオーバーレイクリックで閉じる
      document.getElementById('language-modal-overlay').addEventListener('click', function(e) {
        if (e.target === this) {
          closeLanguageModal();
        }
      });
      
      // Escapeキーでモーダルを閉じる
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeContentModal();
          closeLanguageModal();
        }
        
        // Sキーでセーフティビデオページへ遷移
      if (e.key === 's' || e.key === 'S') {
        window.location.href = 'sb-movie.html';
      }
    });
    });
    
    // 言語選択モーダル制御
    let selectedAudioLanguage = 'ja';
    let selectedSubtitleLanguage = 'ja';
    let currentContentForLanguage = null;
    
    function openLanguageModal() {
      // 現在表示されているモーダルのコンテンツ情報を取得
      const modalTitle = document.getElementById('modal-title').textContent;
      const modalCategory = document.getElementById('modal-category').textContent;
      
      // コンテンツIDを検索
      const allItems = [
        ...getContentData.getAllPopular(),
        ...getContentData.getAllRecommended(),
        ...getContentData.getAllLatestMovies(),
        ...getContentData.getAllAnime(),
        ...getContentData.getAllLiveStreams()
      ];
      
      currentContentForLanguage = allItems.find(item => 
        item.title === modalTitle && item.category === modalCategory
      );
      
      // ライブ配信の場合は言語選択を無効にする
      if (currentContentForLanguage && currentContentForLanguage.isLiveStream) {
        alert('ライブ配信では言語選択はできません。');
        return;
      }
      
      document.getElementById('language-modal-overlay').classList.add('show');
      document.getElementById('language-modal').classList.add('show');
      updateLanguageSelection();
    }
    
    function closeLanguageModal() {
      document.getElementById('language-modal-overlay').classList.remove('show');
      document.getElementById('language-modal').classList.remove('show');
    }
    
    function selectAudioLanguage(langCode) {
      // ライブ配信の場合は言語選択を無効にする
      if (currentContentForLanguage && currentContentForLanguage.isLiveStream) {
        alert('ライブ配信では言語選択はできません。');
        return;
      }
      
      // 利用可能言語をチェック
      if (currentContentForLanguage && currentContentForLanguage.availableLanguages && 
          currentContentForLanguage.availableLanguages.length > 0) {
        if (!currentContentForLanguage.availableLanguages.includes(langCode)) {
          const availableLangNames = currentContentForLanguage.availableLanguages.map(lang => {
            const langNames = { 'ja': '日本語', 'en': 'English', 'ko': '한국어', 'zh': '中文' };
            return langNames[lang] || lang;
          }).join('、');
          alert(`この作品では以下の言語のみ選択可能です：${availableLangNames}`);
          return;
        }
      }
      
      // 音声言語の選択をクリア
      document.querySelectorAll('[id^="audio-"]').forEach(check => {
        check.textContent = '';
      });
      
      // 新しい選択をマーク
      document.getElementById(`audio-${langCode}`).textContent = '✓';
      selectedAudioLanguage = langCode;
    }
    
    function selectSubtitleLanguage(langCode) {
      // ライブ配信の場合は言語選択を無効にする
      if (currentContentForLanguage && currentContentForLanguage.isLiveStream) {
        alert('ライブ配信では言語選択はできません。');
        return;
      }
      
      // 利用可能言語をチェック
      if (currentContentForLanguage && currentContentForLanguage.availableLanguages && 
          currentContentForLanguage.availableLanguages.length > 0) {
        if (!currentContentForLanguage.availableLanguages.includes(langCode)) {
          const availableLangNames = currentContentForLanguage.availableLanguages.map(lang => {
            const langNames = { 'ja': '日本語', 'en': 'English', 'ko': '한국어', 'zh': '中文' };
            return langNames[lang] || lang;
          }).join('、');
          alert(`この作品では以下の言語のみ選択可能です：${availableLangNames}`);
          return;
        }
      }
      
      // 字幕言語の選択をクリア
      document.querySelectorAll('[id^="subtitle-"]').forEach(check => {
        check.textContent = '';
      });
      
      // 新しい選択をマーク
      document.getElementById(`subtitle-${langCode}`).textContent = '✓';
      selectedSubtitleLanguage = langCode;
    }
    
    function updateLanguageSelection() {
      // 保存された設定を読み込み
      selectedAudioLanguage = localStorage.getItem('audioLanguage') || 'ja';
      selectedSubtitleLanguage = localStorage.getItem('subtitleLanguage') || 'ja';
      
      // 音声言語の選択をクリア
      document.querySelectorAll('[id^="audio-"]').forEach(check => {
        check.textContent = '';
      });
      
      // 字幕言語の選択をクリア
      document.querySelectorAll('[id^="subtitle-"]').forEach(check => {
        check.textContent = '';
      });
      
      // 利用可能言語をチェックして選択を調整
      if (currentContentForLanguage && currentContentForLanguage.availableLanguages && 
          currentContentForLanguage.availableLanguages.length > 0) {
        
        console.log('利用可能言語チェック:', currentContentForLanguage.availableLanguages);
        console.log('現在の選択:', { audio: selectedAudioLanguage, subtitle: selectedSubtitleLanguage });
        
        // 音声言語が利用可能でない場合は最初の利用可能言語に変更
        if (!currentContentForLanguage.availableLanguages.includes(selectedAudioLanguage)) {
          selectedAudioLanguage = currentContentForLanguage.availableLanguages[0];
          console.log('音声言語を変更:', selectedAudioLanguage);
        }
        
        // 字幕言語が利用可能でない場合は最初の利用可能言語に変更
        if (!currentContentForLanguage.availableLanguages.includes(selectedSubtitleLanguage)) {
          selectedSubtitleLanguage = currentContentForLanguage.availableLanguages[0];
          console.log('字幕言語を変更:', selectedSubtitleLanguage);
        }
      } else if (currentContentForLanguage && currentContentForLanguage.isLiveStream) {
        // ライブ配信の場合は言語選択を無効にする
        console.log('ライブ配信のため言語選択を無効化');
        return;
      }
      
      // 現在の選択をマーク
      document.getElementById(`audio-${selectedAudioLanguage}`).textContent = '✓';
      document.getElementById(`subtitle-${selectedSubtitleLanguage}`).textContent = '✓';
      
      // 利用可能言語のみを有効にする
      updateAvailableLanguageOptions();
    }
    
    function confirmLanguageSelection() {
      // 設定を保存
      localStorage.setItem('audioLanguage', selectedAudioLanguage);
      localStorage.setItem('subtitleLanguage', selectedSubtitleLanguage);
      
      // モーダルを閉じる
      closeLanguageModal();
      
      // 確認メッセージを表示
      const audioName = getLanguageName(selectedAudioLanguage);
      const subtitleName = selectedSubtitleLanguage === 'off' ? '字幕なし' : getLanguageName(selectedSubtitleLanguage);
      alert(`音声: ${audioName}\n字幕: ${subtitleName}\n\n設定を保存しました。`);
    }
    
    function getLanguageName(langCode) {
      const langNames = {
        'ja': '日本語',
        'en': 'English',
        'ko': '한국어',
        'zh': '中文',
        'off': '字幕なし'
      };
      return langNames[langCode] || langCode;
    }
    
    // 利用可能言語のみを有効にする関数
    function updateAvailableLanguageOptions() {
      const allLanguages = ['ja', 'en', 'ko', 'zh'];
      const availableLanguages = currentContentForLanguage && currentContentForLanguage.availableLanguages ? 
        currentContentForLanguage.availableLanguages : allLanguages;
      
      console.log('利用可能言語:', availableLanguages);
      console.log('現在のコンテンツ:', currentContentForLanguage);
      
      // 音声言語のオプションを更新
      allLanguages.forEach(lang => {
        const audioElement = document.getElementById(`audio-${lang}`);
        const subtitleElement = document.getElementById(`subtitle-${lang}`);
        const audioOption = audioElement ? audioElement.closest('.language-option') : null;
        const subtitleOption = subtitleElement ? subtitleElement.closest('.language-option') : null;
        
        if (audioElement && audioOption) {
          if (availableLanguages.includes(lang)) {
            audioElement.style.opacity = '1';
            audioElement.style.cursor = 'pointer';
            audioElement.style.color = '#1976d2';
            audioElement.title = '';
            audioOption.classList.remove('disabled');
          } else {
            audioElement.style.opacity = '0.3';
            audioElement.style.cursor = 'not-allowed';
            audioElement.style.color = '#999';
            audioElement.title = 'この言語は利用できません';
            audioOption.classList.add('disabled');
          }
        }
        
        if (subtitleElement && subtitleOption) {
          if (availableLanguages.includes(lang)) {
            subtitleElement.style.opacity = '1';
            subtitleElement.style.cursor = 'pointer';
            subtitleElement.style.color = '#1976d2';
            subtitleElement.title = '';
            subtitleOption.classList.remove('disabled');
          } else {
            subtitleElement.style.opacity = '0.3';
            subtitleElement.style.cursor = 'not-allowed';
            subtitleElement.style.color = '#999';
            subtitleElement.title = 'この言語は利用できません';
            subtitleOption.classList.add('disabled');
          }
        }
      });
      
      // 字幕なしオプションは常に有効
      const subtitleOffElement = document.getElementById('subtitle-off');
      const subtitleOffOption = subtitleOffElement ? subtitleOffElement.closest('.language-option') : null;
      if (subtitleOffElement && subtitleOffOption) {
        subtitleOffElement.style.opacity = '1';
        subtitleOffElement.style.cursor = 'pointer';
        subtitleOffElement.style.color = '#1976d2';
        subtitleOffElement.title = '';
        subtitleOffOption.classList.remove('disabled');
      }
    }
    

  </script>
</body>
</html>
